<!-- pages/book/book.wxml - è´­ç¥¨é¡µé¢ -->
<view class="page">
  <!-- è½¦æ¬¡ä¿¡æ¯å¡ç‰‡ -->
  <view class="train-card" wx:if="{{train}}">
    <view class="train-header">
      <text class="train-no">{{train.train_no}}</text>
      <text class="tag {{train.train_type === 'é«˜é“' ? 'tag-blue' : 'tag-green'}}">{{train.train_type}}</text>
    </view>
    <view class="train-route">
      <view class="route-item">
        <text class="time">{{train.departTime}}</text>
        <text class="city">{{train.from_city}}</text>
      </view>
      <view class="route-arrow">â†’</view>
      <view class="route-item">
        <text class="time">{{train.arriveTime}}</text>
        <text class="city">{{train.to_city}}</text>
      </view>
    </view>
    <view class="train-info">
      <text>{{train.date}} Â· ä½™ç¥¨ {{train.seats_remaining}}</text>
    </view>
  </view>

  <!-- èˆ±ä½é€‰æ‹© -->
  <view class="section-card">
    <view class="section-title">é€‰æ‹©èˆ±ä½ç­‰çº§</view>
    <view class="option-list">
      <view 
        class="option-item {{selectedSeat === item.id ? 'active' : ''}}"
        wx:for="{{seatClasses}}"
        wx:key="id"
        bindtap="selectSeat"
        data-id="{{item.id}}"
      >
        <text class="option-icon">{{item.icon}}</text>
        <view class="option-info">
          <text class="option-name">{{item.name}}</text>
          <text class="option-desc">{{item.desc}}</text>
        </view>
        <text class="option-price">Ã—{{item.multiplier}}</text>
      </view>
    </view>
  </view>

  <!-- é¤é£Ÿé€‰æ‹© -->
  <view class="section-card">
    <view class="section-title">é€‰è´­é¤é£Ÿ</view>
    <view class="option-list">
      <view 
        class="option-item {{selectedMeal === item.id ? 'active' : ''}}"
        wx:for="{{mealOptions}}"
        wx:key="id"
        bindtap="selectMeal"
        data-id="{{item.id}}"
      >
        <text class="option-icon">{{item.icon}}</text>
        <view class="option-info">
          <text class="option-name">{{item.name}}</text>
          <text class="option-desc">{{item.desc}}</text>
        </view>
        <text class="option-price" wx:if="{{item.price > 0}}">Â¥{{item.price}}</text>
      </view>
    </view>
  </view>

  <!-- ä¹˜å®¢ä¿¡æ¯ -->
  <view class="section-card">
    <view class="section-title">ä¹˜å®¢ä¿¡æ¯</view>
    <view class="form-group">
      <text class="form-label">ä¹˜å®¢å§“å</text>
      <input 
        class="form-input" 
        type="text" 
        placeholder="è¯·è¾“å…¥çœŸå®å§“å"
        value="{{passengerName}}"
        bindinput="onNameInput"
      />
    </view>
    <view class="form-group">
      <text class="form-label">æ‰‹æœºå·ç </text>
      <input 
        class="form-input" 
        type="number" 
        maxlength="11"
        placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"
        value="{{phone}}"
        bindinput="onPhoneInput"
      />
    </view>
    <view class="form-group">
      <text class="form-label">è´­ç¥¨æ•°é‡</text>
      <picker bindchange="onQuantityChange" value="{{quantity - 1}}" range="{{quantityOptions}}">
        <view class="picker-value">{{quantity}}å¼ </view>
      </picker>
    </view>
  </view>

  <!-- è´¹ç”¨æ±‡æ€» -->
  <view class="section-card summary-card">
    <view class="section-title">è´¹ç”¨æ˜ç»†</view>
    <view class="summary-row">
      <text>ç¥¨ä»· ({{selectedSeatName}})</text>
      <text>Â¥{{summary.ticketPrice}} Ã— {{quantity}}</text>
    </view>
    <view class="summary-row" wx:if="{{summary.mealPrice > 0}}">
      <text>é¤é£Ÿ ({{selectedMealName}})</text>
      <text>Â¥{{summary.mealPrice}} Ã— {{quantity}}</text>
    </view>
    <view class="summary-row points-row">
      <text>ğŸ é¢„è®¡è·å¾—ç§¯åˆ†</text>
      <text class="text-success">+{{summary.points}}</text>
    </view>
    <view class="divider"></view>
    <view class="summary-row total-row">
      <text>åˆè®¡é‡‘é¢</text>
      <text class="total-price">Â¥{{summary.total}}</text>
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="submit-bar safe-bottom">
    <view class="submit-info">
      <text class="submit-label">åˆè®¡:</text>
      <text class="submit-price">Â¥{{summary.total}}</text>
    </view>
    <button 
      class="btn btn-primary submit-btn {{paying ? 'btn-loading' : ''}}" 
      bindtap="submitOrder"
      disabled="{{paying}}"
      loading="{{paying}}"
    >{{paying ? 'æ”¯ä»˜ä¸­...' : 'ç¡®è®¤æ”¯ä»˜'}}</button>
  </view>
</view>
