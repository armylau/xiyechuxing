<!-- pages/trains/trains.wxml - è½¦æ¬¡ç»“æœé¡µ -->
<view class="page">
  <!-- æœ¬åœ°æ•°æ®æç¤º -->
  <view class="local-data-tip" wx:if="{{useLocalData}}">
    <text class="tip-icon">â„¹ï¸</text>
    <text class="tip-text">å½“å‰å±•ç¤ºæ¼”ç¤ºæ•°æ®ï¼Œå®é™…è½¦æ¬¡è¯·ä»¥12306ä¸ºå‡†</text>
  </view>

  <!-- ç»“æœå¤´éƒ¨ -->
  <view class="result-header">
    <view class="route-info">
      <text class="route-cities">{{fromCityName}} â†’ {{toCityName}}</text>
      <text class="route-date">{{date}}</text>
    </view>
  </view>

  <!-- ç­›é€‰æ  -->
  <scroll-view class="filter-bar" scroll-x>
    <view 
      class="filter-chip {{filterType === 'all' ? 'active' : ''}}"
      bindtap="filterTrains"
      data-type="all"
    >å…¨éƒ¨</view>
    <view 
      class="filter-chip {{filterType === 'high' ? 'active' : ''}}"
      bindtap="filterTrains"
      data-type="high"
    >é«˜é“</view>
    <view 
      class="filter-chip {{filterType === 'dong' ? 'active' : ''}}"
      bindtap="filterTrains"
      data-type="dong"
    >åŠ¨è½¦</view>
    <view 
      class="filter-chip {{filterType === 'recommend' ? 'active' : ''}}"
      bindtap="filterTrains"
      data-type="recommend"
    >â­ æ¨è</view>
    <view 
      class="filter-chip {{filterType === 'discount' ? 'active' : ''}}"
      bindtap="filterTrains"
      data-type="discount"
    >ğŸ·ï¸ æŠ˜æ‰£</view>
  </scroll-view>

  <!-- è½¦æ¬¡åˆ—è¡¨ -->
  <view class="train-list">
    <!-- åŠ è½½ä¸­ -->
    <view class="loading" wx:if="{{loading}}">
      <view class="spinner"></view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:elif="{{filteredTrains.length === 0}}">
      <text class="empty-icon">ğŸ”</text>
      <text class="empty-text">æš‚æ— ç¬¦åˆæ¡ä»¶çš„è½¦æ¬¡</text>
    </view>

    <!-- è½¦æ¬¡å¡ç‰‡ -->
    <view 
      class="train-card" 
      wx:for="{{filteredTrains}}"
      wx:key="id"
      bindtap="openBook"
      data-train="{{item}}"
    >
      <!-- è½¦æ¬¡ä¿¡æ¯ -->
      <view class="train-main">
        <view class="train-left">
          <view class="train-header">
            <text class="train-no">{{item.train_no}}</text>
            <text class="tag {{item.train_type === 'é«˜é“' ? 'tag-blue' : 'tag-green'}}">{{item.train_type}}</text>
            <text wx:if="{{item.is_recommended}}" class="recommend-badge">
              â­ {{item.recommend_reasons[0]}}
            </text>
            <text wx:if="{{item.discount}}" class="discount-badge">
              {{item.discount.label}}
            </text>
          </view>
          
          <view class="train-time">
            <view class="time-box">
              <text class="time">{{item.departTime}}</text>
              <text class="station">{{item.from_city}}</text>
            </view>
            <view class="time-arrow">
              <text class="arrow-line">â€”â€”â€”â€”</text>
              <text class="duration">{{item.durationText}}</text>
            </view>
            <view class="time-box">
              <text class="time">{{item.arriveTime}}</text>
              <text class="station">{{item.to_city}}</text>
            </view>
          </view>
        </view>
        
        <view class="train-right">
          <view class="price-box">
            <text wx:if="{{item.discount}}" class="original-price">Â¥{{item.price}}</text>
            <text class="price">
              <text wx:if="{{item.discount}}">Â¥{{item.discount.price}}</text>
              <text wx:else>Â¥{{item.price}}</text>
              <text class="price-unit">/å¼ </text>
            </text>
          </view>
          <text class="seats" style="{{item.seats_remaining < 20 ? 'color: var(--secondary)' : ''}}">
            ä½™ç¥¨ {{item.seats_remaining}}
          </text>
        </view>
      </view>
    </view>
  </view>
</view>
