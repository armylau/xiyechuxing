<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è¥¿é‡å‡ºè¡Œ Â· H5ç¥¨åŠ¡ç³»ç»Ÿ</title>
<style>
:root{--primary:#4F6DF5;--primary-light:#7B93FF;--primary-dark:#3A53CC;--secondary:#FF6B6B;--bg:#F5F7FB;--card:#FFF;--text:#1A1D26;--text-secondary:#6B7280;--border:#E5E7EB;--success:#10B981;--warning:#F59E0B;--radius:16px;--shadow:0 4px 24px rgba(79,109,245,.08)}
*{margin:0;padding:0;box-sizing:border-box}html{font-size:16px}body{font-family:-apple-system,BlinkMacSystemFont,'PingFang SC','Microsoft YaHei',sans-serif;background:var(--bg);color:var(--text);max-width:480px;margin:0 auto;min-height:100vh;overflow-x:hidden}
.page{display:none;padding-bottom:80px}.page.active{display:block}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin:12px 16px}
.btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 24px;border-radius:12px;border:none;font-size:15px;font-weight:600;cursor:pointer;transition:all .2s}
.btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:#fff}.btn-primary:active{transform:scale(.97)}
.btn-block{width:100%}.btn-sm{padding:8px 16px;font-size:13px;border-radius:8px}
.tag{display:inline-block;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:600}
.tag-blue{background:#EEF2FF;color:var(--primary)}.tag-green{background:#D1FAE5;color:#065F46}.tag-orange{background:#FEF3C7;color:#92400E}.tag-red{background:#FEE2E2;color:#991B1B}
input,select{width:100%;padding:12px 16px;border:1.5px solid var(--border);border-radius:12px;font-size:15px;background:#fff;color:var(--text);-webkit-appearance:none}
input:focus,select:focus{outline:none;border-color:var(--primary)}
label{display:block;font-size:13px;font-weight:600;color:var(--text-secondary);margin-bottom:6px}.form-group{margin-bottom:16px}
.header{background:linear-gradient(135deg,var(--primary),var(--primary-light));padding:20px 16px 60px;color:#fff;position:relative}
.header h1{font-size:22px;font-weight:700;margin-bottom:4px}.header p{font-size:13px;opacity:.85}
.header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:30px;background:var(--bg);border-radius:24px 24px 0 0}
.tab-bar{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:480px;background:#fff;display:flex;padding:6px 0 calc(6px + env(safe-area-inset-bottom));box-shadow:0 -2px 16px rgba(0,0,0,.06);z-index:100;border-radius:20px 20px 0 0}
.tab-item{flex:1;display:flex;flex-direction:column;align-items:center;padding:4px 0;cursor:pointer;color:var(--text-secondary);font-size:10px;font-weight:500;border:none;background:none}.tab-item.active{color:var(--primary)}
.tab-item svg{width:22px;height:22px;margin-bottom:1px}.tab-item.active svg{stroke:var(--primary)}
.search-card{margin-top:-40px;position:relative;z-index:10}
.city-selector{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.city-box{flex:1;text-align:center;cursor:pointer;padding:12px;border-radius:12px;background:var(--bg)}
.city-box .city-label{font-size:12px;color:var(--text-secondary)}.city-box .city-name{font-size:20px;font-weight:700;margin-top:4px}
.swap-btn{width:40px;height:40px;border-radius:50%;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;flex-shrink:0;font-size:18px}
.quick-links{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:12px 16px}
.quick-link{display:flex;flex-direction:column;align-items:center;padding:16px 8px;border-radius:var(--radius);background:var(--card);box-shadow:var(--shadow);cursor:pointer;border:none}
.quick-link-icon{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:8px}
.quick-link span{font-size:13px;font-weight:600}
.hot-routes{margin:12px 16px}.hot-routes h3{font-size:16px;font-weight:700;margin-bottom:12px}
.route-chip{display:inline-block;padding:8px 16px;border-radius:20px;background:#EEF2FF;color:var(--primary);font-size:13px;font-weight:500;margin:0 8px 8px 0;cursor:pointer;border:none}
.result-header{display:flex;align-items:center;padding:16px;background:#fff;position:sticky;top:0;z-index:20;box-shadow:0 2px 8px rgba(0,0,0,.04)}
.result-header .back-btn{width:36px;height:36px;border-radius:10px;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;margin-right:12px;font-size:18px}
.result-header .route-info{flex:1;font-size:16px;font-weight:700}.result-header .route-date{font-size:13px;color:var(--text-secondary)}
.filter-bar{display:flex;gap:8px;padding:12px 16px;overflow-x:auto}
.filter-chip{padding:6px 14px;border-radius:20px;border:1.5px solid var(--border);background:#fff;font-size:13px;white-space:nowrap;cursor:pointer}
.filter-chip.active{border-color:var(--primary);background:#EEF2FF;color:var(--primary);font-weight:600}
.train-card{display:flex;align-items:center;padding:16px;border-bottom:1px solid var(--border);background:#fff;cursor:pointer}
.train-left{flex:1}.train-no{font-size:14px;font-weight:700}
.train-time{display:flex;align-items:center;gap:8px;margin-top:8px}
.train-time .time{font-size:22px;font-weight:700}
.train-time .arrow{flex:1;text-align:center;position:relative;font-size:12px;color:var(--text-secondary)}
.train-time .arrow::before{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:var(--border)}
.train-time .arrow span{background:#fff;padding:0 8px;position:relative;z-index:1}
.train-right{text-align:right}
.train-price{font-size:22px;font-weight:700;color:var(--secondary)}.train-price small{font-size:13px}
.train-seats{font-size:12px;color:var(--text-secondary);margin-top:4px}
.recommend-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:6px;background:linear-gradient(135deg,#FEF3C7,#FDE68A);color:#92400E;font-size:11px;font-weight:600;margin-left:8px}
.recommend-badge::before{content:'â­';font-size:10px}
.discount-badge{display:inline-flex;padding:3px 8px;border-radius:6px;background:linear-gradient(135deg,#FEE2E2,#FECACA);color:#991B1B;font-size:11px;font-weight:700;margin-left:6px}
.original-price{text-decoration:line-through;color:var(--text-secondary);font-size:13px;font-weight:400;margin-right:4px}
.empty-state{text-align:center;padding:60px 20px;color:var(--text-secondary)}.empty-state .icon{font-size:48px;margin-bottom:12px}.empty-state p{font-size:14px}
.attraction-card{border-radius:var(--radius);overflow:hidden;background:#fff;box-shadow:var(--shadow);margin:12px 16px;cursor:pointer}
.attraction-card .img-wrapper{height:180px;position:relative;display:flex;align-items:flex-end;padding:16px;background-size:cover;background-position:center}
.attraction-card .img-wrapper .overlay{position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,.55) 0%,rgba(0,0,0,.05) 60%);border-radius:var(--radius) var(--radius) 0 0}
.attraction-card .img-wrapper .name{color:#fff;font-size:20px;font-weight:700;text-shadow:0 2px 8px rgba(0,0,0,.3);position:relative;z-index:2}
.attraction-card .img-wrapper .rating{position:absolute;top:12px;right:12px;background:rgba(255,255,255,.9);padding:4px 10px;border-radius:8px;font-size:13px;font-weight:700;color:var(--warning);z-index:2}
.attraction-card .info{padding:16px}.attraction-card .desc{font-size:14px;color:var(--text-secondary);line-height:1.6;margin-bottom:12px}
.attraction-card .meta{display:flex;align-items:center;justify-content:space-between}
.attraction-card .ticket-price{font-size:18px;font-weight:700;color:var(--secondary)}.attraction-card .view-detail{font-size:13px;color:var(--primary);font-weight:600}
.detail-hero{height:280px;background-size:cover;background-position:center;position:relative}
.detail-hero .overlay{position:absolute;inset:0;background:linear-gradient(0deg,rgba(0,0,0,.6) 0%,rgba(0,0,0,.1) 50%)}
.detail-hero .back-btn{position:absolute;top:16px;left:16px;width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.25);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;cursor:pointer;border:none;color:#fff;font-size:18px;z-index:3}
.detail-hero .hero-info{position:absolute;bottom:20px;left:16px;right:16px;z-index:2;color:#fff}
.detail-hero .hero-info h2{font-size:24px;font-weight:700;margin-bottom:6px;text-shadow:0 2px 8px rgba(0,0,0,.3)}
.detail-hero .hero-info .hero-meta{display:flex;align-items:center;gap:12px;font-size:13px;opacity:.9}
.detail-hero .hero-info .hero-meta .star{background:rgba(255,255,255,.2);padding:3px 10px;border-radius:8px;font-weight:700}
.detail-body{margin-top:-20px;position:relative;z-index:5;border-radius:24px 24px 0 0;background:var(--bg);padding:24px 16px 80px}
.detail-section{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-bottom:12px}
.detail-section h3{font-size:16px;font-weight:700;margin-bottom:12px}
.detail-section p{font-size:14px;line-height:1.8;color:var(--text-secondary)}
.detail-section .info-row{display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid var(--border);font-size:14px}
.detail-section .info-row:last-child{border-bottom:none}
.detail-section .info-row .info-label{flex-shrink:0;width:50px;font-weight:600}.detail-section .info-row .info-value{flex:1;color:var(--text-secondary)}
.detail-tips{list-style:none;padding:0}
.detail-tips li{display:flex;align-items:flex-start;gap:8px;padding:8px 0;font-size:14px;color:var(--text-secondary);line-height:1.6}
.detail-tips li::before{content:'ğŸ’¡';flex-shrink:0}
.detail-gallery{display:flex;gap:10px;overflow-x:auto;padding:4px 0}.detail-gallery::-webkit-scrollbar{display:none}
.detail-gallery img{width:200px;height:140px;border-radius:12px;object-fit:cover;flex-shrink:0}
.detail-price-bar{display:flex;align-items:center;justify-content:space-between;background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px 20px;margin-bottom:12px}
.detail-price-bar .price-info .label{font-size:12px;color:var(--text-secondary)}
.detail-price-bar .price-info .value{font-size:28px;font-weight:700;color:var(--secondary)}.detail-price-bar .price-info .value.free{color:var(--success);font-size:22px}
.order-card{margin:12px 16px;border-radius:var(--radius);background:#fff;box-shadow:var(--shadow);overflow:hidden}
.order-card .order-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--bg);border-bottom:1px solid var(--border)}
.order-card .order-id{font-size:13px;color:var(--text-secondary)}.order-card .order-status{font-size:13px;font-weight:600;color:var(--success)}
.order-card .order-body{padding:16px}.order-card .order-route{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:12px}
.order-card .order-route .city{font-size:18px;font-weight:700}.order-card .order-route .arrow-icon{color:var(--primary);font-size:20px}
.order-card .order-detail{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.order-card .order-detail .item{font-size:13px;color:var(--text-secondary)}.order-card .order-detail .item strong{color:var(--text);font-weight:600}
.order-card .order-footer{padding:14px 16px;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.order-card .order-total{font-size:20px;font-weight:700;color:var(--secondary)}.order-card .order-total small{font-size:13px;font-weight:400;color:var(--text-secondary)}
.order-card .order-extras{font-size:12px;color:var(--text-secondary)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:200;display:none;align-items:flex-end;justify-content:center}
.modal-overlay.active{display:flex}
.modal-content{background:#fff;width:100%;max-width:480px;border-radius:24px 24px 0 0;padding:24px 20px calc(24px + env(safe-area-inset-bottom));max-height:90vh;overflow-y:auto;animation:slideUp .3s ease}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:40px;height:4px;border-radius:2px;background:var(--border);margin:0 auto 16px}
.modal-title{font-size:18px;font-weight:700;margin-bottom:20px}
.city-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.city-grid-item{padding:12px 8px;border-radius:12px;border:1.5px solid var(--border);text-align:center;cursor:pointer;font-size:14px;font-weight:500;background:none}
.city-grid-item.selected{border-color:var(--primary);background:#EEF2FF;color:var(--primary)}
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.75);color:#fff;padding:12px 24px;border-radius:12px;font-size:14px;z-index:999;display:none}
.spinner{display:flex;justify-content:center;padding:40px}.spinner::after{content:'';width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .6s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.grad-1{background:linear-gradient(135deg,#667eea,#764ba2)}.grad-2{background:linear-gradient(135deg,#f093fb,#f5576c)}.grad-3{background:linear-gradient(135deg,#4facfe,#00f2fe)}.grad-4{background:linear-gradient(135deg,#43e97b,#38f9d7)}.grad-5{background:linear-gradient(135deg,#fa709a,#fee140)}.grad-6{background:linear-gradient(135deg,#a18cd1,#fbc2eb)}
.seat-options,.meal-options{display:flex;flex-direction:column;gap:8px}
.seat-opt,.meal-opt{display:flex;align-items:center;gap:12px;padding:12px;border-radius:12px;border:1.5px solid var(--border);cursor:pointer;background:#fff}
.seat-opt.active,.meal-opt.active{border-color:var(--primary);background:#EEF2FF}
.seat-opt .opt-icon,.meal-opt .opt-icon{font-size:24px;flex-shrink:0}
.seat-opt .opt-info,.meal-opt .opt-info{flex:1}.seat-opt .opt-name,.meal-opt .opt-name{font-size:14px;font-weight:600}
.seat-opt .opt-desc,.meal-opt .opt-desc{font-size:12px;color:var(--text-secondary);margin-top:2px}
.seat-opt .opt-price,.meal-opt .opt-price{font-size:15px;font-weight:700;color:var(--secondary);flex-shrink:0}
.rec-card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:10px 16px}
.rec-card .rec-head{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.rec-card .rec-icon{font-size:32px;flex-shrink:0}.rec-card .rec-title{font-size:16px;font-weight:700}
.rec-card .rec-sub{font-size:12px;color:var(--text-secondary)}.rec-card .rec-desc{font-size:13px;color:var(--text-secondary);line-height:1.6;margin-bottom:10px}
.rec-card .rec-meta{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.rec-card .rec-tag{display:inline-block;padding:3px 8px;border-radius:6px;font-size:11px;font-weight:600;background:#EEF2FF;color:var(--primary)}
.rec-card .rec-rating{font-size:13px;font-weight:700;color:var(--warning)}
.rec-card .rec-price{font-size:18px;font-weight:700;color:var(--secondary)}.rec-card .rec-price small{font-size:12px;font-weight:400;color:var(--text-secondary)}
.rec-card .rec-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
.hotel-stars{color:var(--warning);font-size:13px;letter-spacing:2px}
.hotel-dist{font-size:12px;color:var(--primary);font-weight:500;background:#EEF2FF;padding:3px 8px;border-radius:6px}
.book-summary{background:var(--bg);border-radius:12px;padding:14px;margin-bottom:16px;font-size:13px}
.book-summary .sum-row{display:flex;justify-content:space-between;padding:3px 0;color:var(--text-secondary)}
.book-summary .sum-row.total{font-size:16px;font-weight:700;color:var(--text);border-top:1px dashed var(--border);margin-top:6px;padding-top:8px}
.book-summary .sum-row.total .sum-val{color:var(--secondary)}
/* Points card */
.points-card{background:linear-gradient(135deg,#667eea,#764ba2);border-radius:var(--radius);padding:20px;margin:12px 16px;color:#fff;position:relative;overflow:hidden}
.points-card::after{content:'';position:absolute;top:-30px;right:-30px;width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.08)}
.points-card .pts-level{font-size:14px;opacity:.9;margin-bottom:4px}.points-card .pts-value{font-size:36px;font-weight:700}
.points-card .pts-label{font-size:12px;opacity:.75;margin-top:2px}
.points-card .pts-discount{position:absolute;top:16px;right:16px;background:rgba(255,255,255,.2);padding:6px 12px;border-radius:8px;font-size:13px;font-weight:600}
.pts-history{margin:12px 16px}.pts-history-item{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#fff;border-radius:12px;margin-bottom:6px;box-shadow:var(--shadow)}
.pts-history-item .pts-reason{font-size:14px;font-weight:500}.pts-history-item .pts-time{font-size:12px;color:var(--text-secondary)}
.pts-history-item .pts-earned{font-size:16px;font-weight:700;color:var(--success)}
.level-table{margin:12px 16px}
.level-row{display:flex;align-items:center;gap:12px;padding:12px 16px;background:#fff;border-radius:12px;margin-bottom:6px;box-shadow:var(--shadow)}
.level-row .lv-icon{font-size:24px}.level-row .lv-info{flex:1}
.level-row .lv-name{font-size:14px;font-weight:600}.level-row .lv-threshold{font-size:12px;color:var(--text-secondary)}
.level-row .lv-discount{font-size:14px;font-weight:700;color:var(--secondary)}
/* Safety tips */
.safety-card{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin:10px 16px;display:flex;gap:14px;align-items:flex-start}
.safety-card .s-icon{font-size:28px;flex-shrink:0;margin-top:2px}
.safety-card .s-title{font-size:15px;font-weight:700;margin-bottom:4px}
.safety-card .s-content{font-size:13px;color:var(--text-secondary);line-height:1.7}
/* Amap link */
.amap-link{color:var(--primary);text-decoration:none;font-weight:500;transition:opacity .2s}
.amap-link:active{opacity:.7}
.amap-badge{display:inline-block;background:linear-gradient(135deg,#3370FF,#59A5FF);color:#fff;font-size:11px;padding:2px 8px;border-radius:6px;margin-left:6px;font-weight:600;vertical-align:middle}
</style>
</head>
<body>
<div id="toast" class="toast"></div>

<!-- ==================== Page: Home ==================== -->
<div id="page-home" class="page active">
  <div class="header"><h1>ğŸš„ è¥¿é‡å‡ºè¡Œ</h1><p>æ™ºèƒ½é«˜é“ç¥¨åŠ¡ Â· è¯´èµ°å°±èµ°</p></div>
  <div class="card search-card">
    <div class="city-selector">
      <div class="city-box" onclick="openCityPicker('from')"><div class="city-label">å‡ºå‘åŸå¸‚</div><div class="city-name" id="from-city-name">åŒ—äº¬</div></div>
      <button class="swap-btn" onclick="swapCities()">â‡„</button>
      <div class="city-box" onclick="openCityPicker('to')"><div class="city-label">åˆ°è¾¾åŸå¸‚</div><div class="city-name" id="to-city-name">ä¸Šæµ·</div></div>
    </div>
    <div class="form-group"><label>å‡ºå‘æ—¥æœŸ</label><input type="date" id="travel-date"></div>
    <div class="form-group"><label>æ™ºèƒ½åå¥½</label><select id="preference"><option value="fastest">âš¡ é€Ÿåº¦ä¼˜å…ˆ</option><option value="cheapest">ğŸ’° ä»·æ ¼ä¼˜å…ˆ</option><option value="comfortable">ğŸ›‹ï¸ èˆ’é€‚ä¼˜å…ˆ</option></select></div>
    <button class="btn btn-primary btn-block" onclick="searchTrains()">ğŸ” æ™ºèƒ½æœç´¢</button>
  </div>
  <div class="quick-links">
    <button class="quick-link" onclick="quickSearch('BJ','SH')"><div class="quick-link-icon" style="background:#EEF2FF;color:var(--primary)">ğŸš„</div><span>äº¬æ²ªé«˜é“</span></button>
    <button class="quick-link" onclick="quickSearch('CD','CQ')"><div class="quick-link-icon" style="background:#FEF3C7;color:#92400E">ğŸŒ¶ï¸</div><span>æˆæ¸å¿«çº¿</span></button>
    <button class="quick-link" onclick="quickSearch('SH','HZ')"><div class="quick-link-icon" style="background:#D1FAE5;color:#065F46">ğŸƒ</div><span>æ²ªæ­ç›´è¾¾</span></button>
    <button class="quick-link" onclick="quickSearch('BJ','XA')"><div class="quick-link-icon" style="background:#FEE2E2;color:#991B1B">ğŸ¯</div><span>äº¬è¥¿é«˜é“</span></button>
  </div>
  <div class="hot-routes"><h3>ğŸ”¥ çƒ­é—¨è·¯çº¿</h3>
    <button class="route-chip" onclick="quickSearch('BJ','GZ')">åŒ—äº¬â†’å¹¿å·</button><button class="route-chip" onclick="quickSearch('GZ','KM')">å¹¿å·â†’æ˜†æ˜</button><button class="route-chip" onclick="quickSearch('CD','KM')">æˆéƒ½â†’æ˜†æ˜</button><button class="route-chip" onclick="quickSearch('WH','GZ')">æ­¦æ±‰â†’å¹¿å·</button><button class="route-chip" onclick="quickSearch('NJ','HZ')">å—äº¬â†’æ­å·</button><button class="route-chip" onclick="quickSearch('XA','CD')">è¥¿å®‰â†’æˆéƒ½</button>
  </div>
</div>

<!-- ==================== Page: Results ==================== -->
<div id="page-results" class="page">
  <div class="result-header"><button class="back-btn" onclick="showPage('home')">â†</button><div><div class="route-info" id="result-route"></div><div class="route-date" id="result-date"></div></div></div>
  <div class="filter-bar">
    <button class="filter-chip active" onclick="filterTrains(this,'all')">å…¨éƒ¨</button>
    <button class="filter-chip" onclick="filterTrains(this,'high')">é«˜é“</button>
    <button class="filter-chip" onclick="filterTrains(this,'dong')">åŠ¨è½¦</button>
    <button class="filter-chip" onclick="filterTrains(this,'recommend')">â­ æ¨è</button>
    <button class="filter-chip" onclick="filterTrains(this,'discount')">ğŸ·ï¸ æŠ˜æ‰£</button>
  </div>
  <div id="train-list"></div>
</div>

<!-- ==================== Page: Attractions ==================== -->
<div id="page-attractions" class="page">
  <div class="header"><h1>ğŸï¸ ç›®çš„åœ°æ™¯ç‚¹</h1><p>æ¢ç´¢ç²¾å½©ç›®çš„åœ°</p></div>
  <div style="margin-top:-30px;position:relative;z-index:10;padding:0 16px"><select id="attraction-city" onchange="loadAttractions()" style="margin-bottom:12px"></select></div>
  <div id="attraction-list"></div>
</div>

<!-- ==================== Page: Attraction Detail ==================== -->
<div id="page-attraction-detail" class="page">
  <div class="detail-hero" id="detail-hero"><div class="overlay"></div><button class="back-btn" onclick="showPage('attractions')">â†</button><div class="hero-info"><h2 id="detail-name"></h2><div class="hero-meta"><span class="star" id="detail-rating"></span><span id="detail-city-label"></span></div></div></div>
  <div class="detail-body">
    <div class="detail-price-bar"><div class="price-info"><div class="label">é—¨ç¥¨ä»·æ ¼</div><div class="value" id="detail-price"></div></div></div>
    <div class="detail-section"><h3>ğŸ“· å®æ™¯å›¾é›†</h3><div class="detail-gallery" id="detail-gallery"></div></div>
    <div class="detail-section"><h3>ğŸ“– æ™¯ç‚¹ä»‹ç»</h3><p id="detail-desc"></p></div>
    <div class="detail-section"><h3>â„¹ï¸ åŸºæœ¬ä¿¡æ¯</h3><div id="detail-info"></div></div>
    <div class="detail-section"><h3>ğŸ’¡ æ¸¸è§ˆè´´å£«</h3><ul class="detail-tips" id="detail-tips"></ul></div>
  </div>
</div>

<!-- ==================== Page: Explore ==================== -->
<div id="page-explore" class="page">
  <div class="header"><h1>ğŸ½ï¸ åƒä½æ¨è</h1><p>å‘ç°ç›®çš„åœ°ç¾é£Ÿä¸ä¼˜é€‰é…’åº—</p></div>
  <div style="margin-top:-30px;position:relative;z-index:10;padding:0 16px">
    <select id="explore-city" onchange="loadExplore()" style="margin-bottom:8px"></select>
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <button class="filter-chip active" id="exp-tab-food" onclick="switchExpTab('food')">ğŸœ ç¾é£Ÿæ¨è</button>
      <button class="filter-chip" id="exp-tab-hotel" onclick="switchExpTab('hotel')">ğŸ¨ ä¼˜é€‰é…’åº—</button>
    </div>
  </div>
  <div id="explore-list"></div>
</div>

<!-- ==================== Page: My (Orders + Points + Safety) ==================== -->
<div id="page-my" class="page">
  <div class="header"><h1>ğŸ‘¤ æˆ‘çš„</h1><p>è®¢å• Â· ç§¯åˆ† Â· å®‰å…¨å‡ºè¡Œ</p></div>
  <div style="margin-top:-30px;position:relative;z-index:10;padding:0 16px">
    <div style="display:flex;gap:8px;margin-bottom:8px">
      <button class="filter-chip active" id="my-tab-orders" onclick="switchMyTab('orders')">ğŸ“‹ è®¢å•</button>
      <button class="filter-chip" id="my-tab-points" onclick="switchMyTab('points')">â­ ç§¯åˆ†</button>
      <button class="filter-chip" id="my-tab-safety" onclick="switchMyTab('safety')">ğŸ›¡ï¸ å®‰å…¨</button>
    </div>
  </div>
  <!-- Orders sub-tab -->
  <div id="my-orders-section">
    <div style="padding:0 16px;display:flex;gap:8px;margin-bottom:8px">
      <input type="tel" id="order-phone" placeholder="è¾“å…¥æ‰‹æœºå·æŸ¥è¯¢" style="flex:1">
      <button class="btn btn-primary btn-sm" onclick="loadOrders()">æŸ¥è¯¢</button>
    </div>
    <div id="order-list"></div>
  </div>
  <!-- Points sub-tab -->
  <div id="my-points-section" style="display:none">
    <div style="padding:0 16px;display:flex;gap:8px;margin-bottom:8px">
      <input type="tel" id="points-phone" placeholder="è¾“å…¥æ‰‹æœºå·æŸ¥è¯¢ç§¯åˆ†" style="flex:1">
      <button class="btn btn-primary btn-sm" onclick="loadPoints()">æŸ¥è¯¢</button>
    </div>
    <div id="points-info"></div>
  </div>
  <!-- Safety sub-tab -->
  <div id="my-safety-section" style="display:none">
    <div id="safety-list"><div class="spinner"></div></div>
  </div>
</div>

<!-- ==================== Tab Bar ==================== -->
<div class="tab-bar">
  <button class="tab-item active" onclick="showPage('home')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>é¦–é¡µ</button>
  <button class="tab-item" onclick="showPage('attractions')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>æ™¯ç‚¹</button>
  <button class="tab-item" onclick="showPage('explore')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8h1a4 4 0 010 8h-1"/><path d="M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>åƒä½</button>
  <button class="tab-item" onclick="showPage('my')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>æˆ‘çš„</button>
</div>

<!-- Modals -->
<div id="city-modal" class="modal-overlay" onclick="if(event.target===this)closeCityPicker()"><div class="modal-content"><div class="modal-handle"></div><div class="modal-title" id="city-modal-title">é€‰æ‹©åŸå¸‚</div><div class="city-grid" id="city-grid"></div></div></div>
<div id="book-modal" class="modal-overlay" onclick="if(event.target===this)closeBookModal()">
  <div class="modal-content">
    <div class="modal-handle"></div><div class="modal-title">ç¡®è®¤è´­ç¥¨</div>
    <div id="book-train-info" style="margin-bottom:16px"></div>
    <div class="form-group"><label>èˆ±ä½ç­‰çº§</label><div class="seat-options" id="seat-options"></div></div>
    <div class="form-group"><label>é€‰è´­é¤é£Ÿ</label><div class="meal-options" id="meal-options"></div></div>
    <div class="form-group"><label>ä¹˜å®¢å§“å</label><input type="text" id="book-name" placeholder="è¯·è¾“å…¥çœŸå®å§“å"></div>
    <div class="form-group"><label>æ‰‹æœºå·ç </label><input type="tel" id="book-phone" placeholder="è¯·è¾“å…¥11ä½æ‰‹æœºå·"></div>
    <div class="form-group"><label>è´­ç¥¨æ•°é‡</label><select id="book-quantity"><option value="1">1å¼ </option><option value="2">2å¼ </option><option value="3">3å¼ </option><option value="4">4å¼ </option><option value="5">5å¼ </option></select></div>
    <div class="book-summary" id="book-summary"></div>
    <button class="btn btn-primary btn-block" onclick="submitOrder()">ç¡®è®¤æ”¯ä»˜</button>
  </div>
</div>

<script>
const API='';
let cities=[],seatClasses=[],mealOptions=[];
let currentFromId='BJ',currentToId='SH',cityPickerTarget='from';
let allTrainResults=[],discountResults=[],recommendedIds=new Set(),selectedTrain=null;
let selectedSeat='second',selectedMeal='none';
let exploreTab='food',myTab='orders';

document.addEventListener('DOMContentLoaded',async()=>{
  const today=new Date();
  document.getElementById('travel-date').value=today.toISOString().split('T')[0];
  document.getElementById('travel-date').min=today.toISOString().split('T')[0];
  const[cR,sR,mR]=await Promise.all([fetch(`${API}/api/cities`).then(r=>r.json()),fetch(`${API}/api/seat_classes`).then(r=>r.json()),fetch(`${API}/api/meals`).then(r=>r.json())]);
  cities=cR.data;seatClasses=sR.data;mealOptions=mR.data;
  ['attraction-city','explore-city'].forEach(id=>{const s=document.getElementById(id);cities.forEach(c=>{const o=document.createElement('option');o.value=c.id;o.textContent=c.name;s.appendChild(o)})});
  loadAttractions();loadExplore();loadSafetyTips();
});

const TAB_NAMES=['home','attractions','explore','my'];
function showPage(name){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(`page-${name}`).classList.add('active');
  document.querySelectorAll('.tab-item').forEach((t,i)=>t.classList.toggle('active',TAB_NAMES[i]===name));
  if(name==='my'&&myTab==='orders')loadOrders();
  if(name==='explore')loadExplore();
  window.scrollTo(0,0);
}
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.style.display='block';setTimeout(()=>t.style.display='none',2000)}
function openCityPicker(target){cityPickerTarget=target;document.getElementById('city-modal-title').textContent=target==='from'?'é€‰æ‹©å‡ºå‘åŸå¸‚':'é€‰æ‹©åˆ°è¾¾åŸå¸‚';const g=document.getElementById('city-grid');g.innerHTML='';const cur=target==='from'?currentFromId:currentToId;cities.forEach(c=>{const b=document.createElement('button');b.className=`city-grid-item ${c.id===cur?'selected':''}`;b.textContent=c.name;b.onclick=()=>selectCity(c);g.appendChild(b)});document.getElementById('city-modal').classList.add('active')}
function closeCityPicker(){document.getElementById('city-modal').classList.remove('active')}
function selectCity(c){if(cityPickerTarget==='from'){currentFromId=c.id;document.getElementById('from-city-name').textContent=c.name}else{currentToId=c.id;document.getElementById('to-city-name').textContent=c.name}closeCityPicker()}
function swapCities(){[currentFromId,currentToId]=[currentToId,currentFromId];document.getElementById('from-city-name').textContent=cityName(currentFromId);document.getElementById('to-city-name').textContent=cityName(currentToId)}
function cityName(id){const c=cities.find(c=>c.id===id);return c?c.name:id}

async function searchTrains(){
  if(currentFromId===currentToId){showToast('å‡ºå‘å’Œåˆ°è¾¾åŸå¸‚ä¸èƒ½ç›¸åŒ');return}
  const date=document.getElementById('travel-date').value;if(!date){showToast('è¯·é€‰æ‹©å‡ºå‘æ—¥æœŸ');return}
  const pref=document.getElementById('preference').value;
  showPage('results');
  document.getElementById('result-route').textContent=`${cityName(currentFromId)} â†’ ${cityName(currentToId)}`;
  document.getElementById('result-date').textContent=date;
  document.getElementById('train-list').innerHTML='<div class="spinner"></div>';
  const[sR,rR,dR]=await Promise.all([
    fetch(`${API}/api/trains/search?from=${currentFromId}&to=${currentToId}&date=${date}`).then(r=>r.json()),
    fetch(`${API}/api/trains/recommend?from=${currentFromId}&to=${currentToId}&date=${date}&preference=${pref}`).then(r=>r.json()),
    fetch(`${API}/api/trains/discount?from=${currentFromId}&to=${currentToId}&date=${date}`).then(r=>r.json()),
  ]);
  allTrainResults=sR.data||[];recommendedIds=new Set((rR.data||[]).map(t=>t.id));
  discountResults=dR.data||[];
  const discountMap={};discountResults.forEach(d=>{discountMap[d.id]={rate:d.discount_rate,price:d.discounted_price,label:d.discount_label,reasons:d.discount_reasons}});
  const recMap={};(rR.data||[]).forEach(t=>{recMap[t.id]=t.recommend_reasons||[]});
  allTrainResults.forEach(t=>{t.recommend_reasons=recMap[t.id]||[];t.is_recommended=recommendedIds.has(t.id);if(discountMap[t.id]){t.discount=discountMap[t.id]}});
  renderTrains(allTrainResults);
}
function quickSearch(f,t){currentFromId=f;currentToId=t;document.getElementById('from-city-name').textContent=cityName(f);document.getElementById('to-city-name').textContent=cityName(t);searchTrains()}
function filterTrains(el,type){document.querySelectorAll('#page-results .filter-chip').forEach(c=>c.classList.remove('active'));el.classList.add('active');let f=allTrainResults;if(type==='high')f=f.filter(t=>t.train_type==='é«˜é“');else if(type==='dong')f=f.filter(t=>t.train_type==='åŠ¨è½¦');else if(type==='recommend')f=f.filter(t=>t.is_recommended);else if(type==='discount')f=f.filter(t=>t.discount);renderTrains(f)}
function renderTrains(trains){
  const c=document.getElementById('train-list');
  if(!trains.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸ”</div><p>æš‚æ— ç¬¦åˆæ¡ä»¶çš„è½¦æ¬¡</p></div>';return}
  c.innerHTML=trains.map(t=>{
    const dT=t.depart_time.split(' ')[1],aT=t.arrive_time.split(' ')[1];
    const h=Math.floor(t.duration/60),m=t.duration%60,dur=`${h}h${m>0?m+'m':''}`;
    const tag=t.train_type==='é«˜é“'?'<span class="tag tag-blue">é«˜é“</span>':'<span class="tag tag-green">åŠ¨è½¦</span>';
    const rec=t.is_recommended?`<span class="recommend-badge">${t.recommend_reasons.slice(0,2).join(' Â· ')}</span>`:'';
    const disc=t.discount?`<span class="discount-badge">ğŸ·ï¸ ${t.discount.label}</span>`:'';
    const priceHtml=t.discount?`<span class="original-price">Â¥${t.price}</span>Â¥${t.discount.price}`:`Â¥${t.price}`;
    return `<div class="train-card" onclick='openBookModal(${JSON.stringify(t).replace(/'/g,"&#39;")})'>
      <div class="train-left"><div><span class="train-no">${t.train_no}</span>${tag}${rec}${disc}</div>
      <div class="train-time"><span class="time">${dT}</span><span class="arrow"><span>${dur}</span></span><span class="time">${aT}</span></div></div>
      <div class="train-right"><div class="train-price">${priceHtml}<small>/å¼ </small></div><div class="train-seats" style="${t.seats_remaining<20?'color:var(--secondary)':''}">ä½™ç¥¨ ${t.seats_remaining}</div></div></div>`;
  }).join('');
}

function openBookModal(train){
  selectedTrain=train;selectedSeat='second';selectedMeal='none';
  document.getElementById('book-train-info').innerHTML=`<div style="background:var(--bg);border-radius:12px;padding:14px">
    <div style="display:flex;justify-content:space-between;margin-bottom:8px"><span style="font-weight:700">${train.train_no}</span><span class="tag tag-blue">${train.train_type}</span></div>
    <div style="display:flex;justify-content:space-between;align-items:center"><div style="text-align:center"><div style="font-size:20px;font-weight:700">${train.depart_time.split(' ')[1]}</div><div style="font-size:12px;color:var(--text-secondary)">${train.from_city}</div></div><div style="color:var(--text-secondary)">â†’</div><div style="text-align:center"><div style="font-size:20px;font-weight:700">${train.arrive_time.split(' ')[1]}</div><div style="font-size:12px;color:var(--text-secondary)">${train.to_city}</div></div></div>
    <div style="text-align:center;margin-top:8px;font-size:13px;color:var(--text-secondary)">${train.date} Â· ä½™ç¥¨ ${train.seats_remaining}</div></div>`;
  document.getElementById('seat-options').innerHTML=seatClasses.map(s=>`<div class="seat-opt ${s.id===selectedSeat?'active':''}" onclick="selectSeat('${s.id}')"><span class="opt-icon">${s.icon}</span><div class="opt-info"><div class="opt-name">${s.name}</div><div class="opt-desc">${s.desc}</div></div><span class="opt-price">Ã—${s.multiplier}</span></div>`).join('');
  document.getElementById('meal-options').innerHTML=mealOptions.map(m=>`<div class="meal-opt ${m.id===selectedMeal?'active':''}" onclick="selectMeal('${m.id}')"><span class="opt-icon">${m.icon}</span><div class="opt-info"><div class="opt-name">${m.name}</div><div class="opt-desc">${m.desc}</div></div><span class="opt-price">${m.price?'Â¥'+m.price:''}</span></div>`).join('');
  document.getElementById('book-quantity').value='1';document.getElementById('book-quantity').onchange=updateBookSummary;
  updateBookSummary();document.getElementById('book-modal').classList.add('active');
}
function closeBookModal(){document.getElementById('book-modal').classList.remove('active')}
function selectSeat(id){selectedSeat=id;document.querySelectorAll('.seat-opt').forEach(e=>e.classList.toggle('active',e.querySelector('.opt-name').textContent===seatClasses.find(s=>s.id===id).name));updateBookSummary()}
function selectMeal(id){selectedMeal=id;document.querySelectorAll('.meal-opt').forEach(e=>e.classList.toggle('active',e.querySelector('.opt-name').textContent===mealOptions.find(m=>m.id===id).name));updateBookSummary()}
function updateBookSummary(){
  if(!selectedTrain)return;const qty=parseInt(document.getElementById('book-quantity').value);
  const seat=seatClasses.find(s=>s.id===selectedSeat);const meal=mealOptions.find(m=>m.id===selectedMeal);
  const tp=Math.round(selectedTrain.price*seat.multiplier*10)/10;const mt=meal.price*qty;const tot=Math.round((tp*qty+mt)*10)/10;
  const pts=Math.floor(tot);
  document.getElementById('book-summary').innerHTML=`
    <div class="sum-row"><span>ç¥¨ä»· (${seat.name})</span><span>Â¥${tp} Ã— ${qty}</span></div>
    ${meal.price?`<div class="sum-row"><span>é¤é£Ÿ (${meal.name})</span><span>Â¥${meal.price} Ã— ${qty}</span></div>`:''}
    <div class="sum-row" style="color:var(--success)"><span>ğŸ é¢„è®¡è·å¾—ç§¯åˆ†</span><span>+${pts}</span></div>
    <div class="sum-row total"><span>åˆè®¡é‡‘é¢</span><span class="sum-val">Â¥${tot}</span></div>`;
}
async function submitOrder(){
  const name=document.getElementById('book-name').value.trim();const phone=document.getElementById('book-phone').value.trim();const qty=parseInt(document.getElementById('book-quantity').value);
  if(!name){showToast('è¯·è¾“å…¥ä¹˜å®¢å§“å');return}if(!/^1\d{10}$/.test(phone)){showToast('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');return}
  const res=await fetch(`${API}/api/orders`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({train_id:selectedTrain.id,passenger_name:name,phone,quantity:qty,seat_class:selectedSeat,meal:selectedMeal})});
  const json=await res.json();
  if(json.code===0){showToast(`ğŸ‰ è´­ç¥¨æˆåŠŸï¼è·å¾—${json.points_earned}ç§¯åˆ†`);closeBookModal();document.getElementById('order-phone').value=phone;document.getElementById('points-phone').value=phone;setTimeout(()=>showPage('my'),1200)}else{showToast(json.msg||'è´­ç¥¨å¤±è´¥')}
}

async function loadAttractions(){const cityId=document.getElementById('attraction-city').value;const c=document.getElementById('attraction-list');c.innerHTML='<div class="spinner"></div>';const res=await fetch(`${API}/api/attractions?city_id=${cityId}`);const json=await res.json();const data=json.data||[];const grads=['grad-1','grad-2','grad-3','grad-4','grad-5','grad-6'];if(!data.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸï¸</div><p>æš‚æ— æ™¯ç‚¹ä¿¡æ¯</p></div>';return}c.innerHTML=data.map((a,i)=>`<div class="attraction-card" onclick="openAttractionDetail('${a.id}')"><div class="img-wrapper ${grads[i%6]}" style="background-image:url('${a.image}')"><div class="overlay"></div><div class="name">${a.name}</div><div class="rating">â­ ${a.rating}</div></div><div class="info"><div class="desc">${a.desc}</div><div class="meta"><div class="ticket-price">${a.ticket_price==='0'?'<span style="color:var(--success);font-size:16px;font-weight:700">å…è´¹</span>':`Â¥${a.ticket_price} <small>/ äºº</small>`}</div><span class="view-detail">æŸ¥çœ‹è¯¦æƒ… â†’</span></div></div></div>`).join('')}
async function openAttractionDetail(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById('page-attraction-detail').classList.add('active');document.querySelectorAll('.tab-item').forEach((t,i)=>t.classList.toggle('active',i===1));window.scrollTo(0,0);const res=await fetch(`${API}/api/attractions/${id}`);const json=await res.json();if(json.code!==0){showToast('åŠ è½½å¤±è´¥');return}const a=json.data,city=json.city;document.getElementById('detail-hero').style.backgroundImage=`url('${a.image}')`;document.getElementById('detail-name').textContent=a.name;document.getElementById('detail-rating').textContent=`â­ ${a.rating}`;document.getElementById('detail-city-label').textContent=`ğŸ“ ${city}`;const pE=document.getElementById('detail-price');if(a.ticket_price==='0'){pE.textContent='å…è´¹å¼€æ”¾';pE.className='value free'}else{pE.innerHTML=`Â¥${a.ticket_price} <span style="font-size:14px;font-weight:400;color:var(--text-secondary)">/ äºº</span>`;pE.className='value'}document.getElementById('detail-gallery').innerHTML=(a.gallery||[]).map(u=>`<img src="${u}" alt="${a.name}" loading="lazy">`).join('');document.getElementById('detail-desc').textContent=a.detail||a.desc;document.getElementById('detail-info').innerHTML=`<div class="info-row"><span class="info-label">ğŸ• æ—¶é—´</span><span class="info-value">${a.open_time||'æš‚æ— '}</span></div><div class="info-row"><span class="info-label">ğŸ“ åœ°å€</span><span class="info-value">${a.amap_url?`<a href="${a.amap_url}" target="_blank" class="amap-link">${a.address||'æš‚æ— '} <span class="amap-badge">ğŸ“ é«˜å¾·åœ°å›¾</span></a>`:a.address||'æš‚æ— '}</span></div><div class="info-row"><span class="info-label">ğŸ« é—¨ç¥¨</span><span class="info-value">${a.ticket_price==='0'?'å…è´¹':`Â¥${a.ticket_price}/äºº`}</span></div>`;document.getElementById('detail-tips').innerHTML=(a.tips||[]).map(t=>`<li>${t}</li>`).join('')}

function switchExpTab(tab){exploreTab=tab;document.getElementById('exp-tab-food').classList.toggle('active',tab==='food');document.getElementById('exp-tab-hotel').classList.toggle('active',tab==='hotel');loadExplore()}
async function loadExplore(){const cityId=document.getElementById('explore-city').value;const c=document.getElementById('explore-list');c.innerHTML='<div class="spinner"></div>';if(exploreTab==='food'){const res=await fetch(`${API}/api/foods?city_id=${cityId}`);const json=await res.json();const data=json.data||[];if(!data.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸœ</div><p>æš‚æ— ç¾é£Ÿæ¨è</p></div>';return}c.innerHTML=data.map(f=>`<div class="rec-card"><div class="rec-head"><span class="rec-icon">${f.icon}</span><div><div class="rec-title">${f.name}</div><div class="rec-sub">${f.type} Â· ${f.amap_url?`<a href="${f.amap_url}" target="_blank" class="amap-link">${f.address} ğŸ“</a>`:f.address}</div></div></div><div class="rec-desc">${f.desc}</div><div class="rec-meta">${(f.tags||[]).map(t=>`<span class="rec-tag">${t}</span>`).join('')}</div><div class="rec-bottom"><span class="rec-rating">â­ ${f.rating}</span><span class="rec-price">Â¥${f.price_per_person}<small>/äºº</small></span></div></div>`).join('')}else{const res=await fetch(`${API}/api/hotels?city_id=${cityId}`);const json=await res.json();const data=json.data||[];if(!data.length){c.innerHTML='<div class="empty-state"><div class="icon">ğŸ¨</div><p>æš‚æ— é…’åº—æ¨è</p></div>';return}c.innerHTML=data.map(h=>`<div class="rec-card"><div class="rec-head"><span class="rec-icon">${h.icon}</span><div><div class="rec-title">${h.name}</div><div class="rec-sub"><span class="hotel-stars">${'â˜…'.repeat(h.stars)}</span> Â· ${h.amap_url?`<a href="${h.amap_url}" target="_blank" class="amap-link">${h.address} ğŸ“</a>`:h.address}</div></div></div><div class="rec-desc">${h.desc}</div><div class="rec-meta">${(h.tags||[]).map(t=>`<span class="rec-tag">${t}</span>`).join('')}<span class="hotel-dist">${h.distance}</span></div><div class="rec-bottom"><span class="rec-rating">â­ ${h.rating}</span><span class="rec-price">Â¥${h.price}<small>/æ™š</small></span></div></div>`).join('')}}

function switchMyTab(tab){myTab=tab;['orders','points','safety'].forEach(t=>{document.getElementById(`my-tab-${t}`).classList.toggle('active',t===tab);document.getElementById(`my-${t}-section`).style.display=t===tab?'block':'none'});if(tab==='orders')loadOrders();if(tab==='points')loadPoints()}
async function loadOrders(){const phone=document.getElementById('order-phone').value.trim();const c=document.getElementById('order-list');c.innerHTML='<div class="spinner"></div>';const url=phone?`${API}/api/orders?phone=${phone}`:`${API}/api/orders`;const res=await fetch(url);const json=await res.json();const data=json.data||[];if(!data.length){c.innerHTML=`<div class="empty-state"><div class="icon">ğŸ“‹</div><p>${phone?'æš‚æ— è¯¥æ‰‹æœºå·çš„è®¢å•':'æš‚æ— è®¢å•è®°å½•'}</p></div>`;return}c.innerHTML=data.map(o=>`<div class="order-card"><div class="order-header"><span class="order-id">è®¢å•å·: ${o.order_id}</span><span class="order-status">${o.status}</span></div><div class="order-body"><div class="order-route"><span class="city">${o.train.from_city}</span><span class="arrow-icon">â†’</span><span class="city">${o.train.to_city}</span></div><div class="order-detail"><div class="item">è½¦æ¬¡: <strong>${o.train.train_no}</strong></div><div class="item">æ—¥æœŸ: <strong>${o.train.date}</strong></div><div class="item">ä¹˜å®¢: <strong>${o.passenger_name}</strong></div><div class="item">æ•°é‡: <strong>${o.quantity}å¼ </strong></div><div class="item">å‡ºå‘: <strong>${o.train.depart_time.split(' ')[1]}</strong></div><div class="item">åˆ°è¾¾: <strong>${o.train.arrive_time.split(' ')[1]}</strong></div><div class="item">èˆ±ä½: <strong>${o.seat_class?o.seat_class.icon+' '+o.seat_class.name:'äºŒç­‰åº§'}</strong></div><div class="item">é¤é£Ÿ: <strong>${o.meal&&o.meal.id!=='none'?o.meal.icon+' '+o.meal.name:'æœªé€‰è´­'}</strong></div></div></div><div class="order-footer"><span class="order-extras">${o.points_earned?'ğŸ +'+o.points_earned+'ç§¯åˆ†':''}${o.meal&&o.meal.id!=='none'?' Â· å«é¤é£Ÿ Â¥'+o.meal_total:''}</span><span class="order-total"><small>åˆè®¡ </small>Â¥${typeof o.total_price==='number'?o.total_price.toFixed(1):o.total_price}</span></div></div>`).join('')}

async function loadPoints(){const phone=document.getElementById('points-phone').value.trim();const c=document.getElementById('points-info');if(!phone){c.innerHTML='<div class="empty-state"><div class="icon">â­</div><p>è¯·è¾“å…¥æ‰‹æœºå·æŸ¥è¯¢ç§¯åˆ†</p></div>';return}c.innerHTML='<div class="spinner"></div>';const[pR,lR]=await Promise.all([fetch(`${API}/api/points?phone=${phone}`).then(r=>r.json()),fetch(`${API}/api/points/levels`).then(r=>r.json())]);const p=pR.data;const levels=lR.data||[];c.innerHTML=`<div class="points-card"><div class="pts-level">${p.level_icon||'ğŸ«'} ${p.level||'æ™®é€šä¼šå‘˜'}</div><div class="pts-value">${p.points||0}</div><div class="pts-label">å½“å‰å¯ç”¨ç§¯åˆ† Â· ç´¯è®¡è·å¾— ${p.total_earned||0}</div>${p.discount?`<div class="pts-discount">äº«${Math.round(p.discount*100)}%æŠ˜æ‰£</div>`:''}</div><div style="padding:0 16px;margin:16px 0 8px"><h3 style="font-size:16px;font-weight:700">ğŸ“Š ç­‰çº§è§„åˆ™</h3></div><div class="level-table">${levels.map(l=>`<div class="level-row ${p.level===l.level?'style="border:2px solid var(--primary)"':''}"><span class="lv-icon">${l.icon}</span><div class="lv-info"><div class="lv-name">${l.level}</div><div class="lv-threshold">â‰¥ ${l.threshold} ç§¯åˆ†</div></div><span class="lv-discount">${l.discount>0?l.discount_label:'â€”'}</span></div>`).join('')}</div>${(p.history&&p.history.length)?`<div style="padding:0 16px;margin:16px 0 8px"><h3 style="font-size:16px;font-weight:700">ğŸ“œ ç§¯åˆ†æ˜ç»†</h3></div><div class="pts-history">${p.history.slice(0,10).map(h=>`<div class="pts-history-item"><div><div class="pts-reason">${h.reason}</div><div class="pts-time">${h.time}</div></div><span class="pts-earned">+${h.earned}</span></div>`).join('')}</div>`:''}`}

async function loadSafetyTips(){const res=await fetch(`${API}/api/safety_tips`);const json=await res.json();const data=json.data||[];document.getElementById('safety-list').innerHTML=`<div style="padding:0 16px;margin-bottom:12px"><div class="card" style="background:linear-gradient(135deg,#FEF3C7,#FDE68A);margin:0;padding:16px"><div style="font-size:15px;font-weight:700;color:#92400E;margin-bottom:4px">ğŸ›¡ï¸ å®‰å…¨å‡ºè¡Œï¼Œå¹³å®‰åˆ°è¾¾</div><div style="font-size:13px;color:#92400E;opacity:.8">è¯·ä»”ç»†é˜…è¯»ä»¥ä¸‹å‡ºè¡Œå®‰å…¨é¡»çŸ¥ï¼Œç¡®ä¿æ—…é€”é¡ºåˆ©æ„‰å¿«</div></div></div>${data.map(t=>`<div class="safety-card"><span class="s-icon">${t.icon}</span><div><div class="s-title">${t.title}</div><div class="s-content">${t.content}</div></div></div>`).join('')}`}
</script>
</body>
</html>
