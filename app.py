"""H5 Á•®Âä°Á≥ªÁªü - Flask ÂêéÁ´ØÊúçÂä°"""

from __future__ import annotations

import json
import os
import uuid
from datetime import datetime, timedelta
from pathlib import Path
from typing import Any
from urllib.parse import quote

from flask import Flask, jsonify, request, send_from_directory
from flask_cors import CORS

app = Flask(__name__, static_folder="static", static_url_path="")
CORS(app)

DATA_DIR: Path = Path(__file__).parent / "data"
ORDERS_FILE: Path = DATA_DIR / "orders.json"
POINTS_FILE: Path = DATA_DIR / "points.json"

# =============================================================================
# ÊåÅ‰πÖÂåñÂ∑•ÂÖ∑
# =============================================================================


def _ensure_data_dir() -> None:
    """Á°Æ‰øùÊï∞ÊçÆÁõÆÂΩïÂ≠òÂú®"""
    DATA_DIR.mkdir(parents=True, exist_ok=True)


def _load_orders() -> list[dict[str, Any]]:
    """‰ªé JSON Êñá‰ª∂Âä†ËΩΩËÆ¢Âçï"""
    if ORDERS_FILE.exists():
        try:
            return json.loads(ORDERS_FILE.read_text(encoding="utf-8"))
        except (json.JSONDecodeError, OSError):
            return []
    return []


def _save_orders(orders: list[dict[str, Any]]) -> None:
    """Â∞ÜËÆ¢ÂçïÂÜôÂÖ• JSON Êñá‰ª∂"""
    _ensure_data_dir()
    ORDERS_FILE.write_text(
        json.dumps(orders, ensure_ascii=False, indent=2),
        encoding="utf-8",
    )


def _load_points() -> dict[str, Any]:
    """Âä†ËΩΩÁßØÂàÜÊï∞ÊçÆ {phone: {points, level, history}}"""
    if POINTS_FILE.exists():
        try:
            return json.loads(POINTS_FILE.read_text(encoding="utf-8"))
        except (json.JSONDecodeError, OSError):
            return {}
    return {}


def _save_points(points: dict[str, Any]) -> None:
    """‰øùÂ≠òÁßØÂàÜÊï∞ÊçÆ"""
    _ensure_data_dir()
    POINTS_FILE.write_text(
        json.dumps(points, ensure_ascii=False, indent=2),
        encoding="utf-8",
    )


# ÁßØÂàÜËßÑÂàôÂ∏∏Èáè
POINTS_PER_YUAN: int = 1  # ÊØèÊ∂àË¥π 1 ÂÖÉËé∑Âæó 1 ÁßØÂàÜ
LEVEL_THRESHOLDS: list[tuple[int, str, str, float]] = [
    # (ÁßØÂàÜÈó®Êßõ, Á≠âÁ∫ßÂêçÁß∞, ÂõæÊ†á, ÊäòÊâ£Áéá)
    (0, "ÊôÆÈÄö‰ºöÂëò", "üé´", 0.0),
    (500, "ÁôΩÈì∂‰ºöÂëò", "ü•à", 0.02),
    (2000, "ÈªÑÈáë‰ºöÂëò", "ü•á", 0.05),
    (5000, "ÈìÇÈáë‰ºöÂëò", "üíé", 0.08),
    (10000, "ÈíªÁü≥‰ºöÂëò", "üëë", 0.10),
]


def _calc_level(points: int) -> tuple[str, str, float]:
    """Ê†πÊçÆÊÄªÁßØÂàÜËÆ°ÁÆóÁ≠âÁ∫ßÔºåËøîÂõû (Á≠âÁ∫ßÂêç, ÂõæÊ†á, ÊäòÊâ£Áéá)"""
    name, icon, discount = LEVEL_THRESHOLDS[0][1], LEVEL_THRESHOLDS[0][2], LEVEL_THRESHOLDS[0][3]
    for threshold, lv_name, lv_icon, lv_discount in LEVEL_THRESHOLDS:
        if points >= threshold:
            name, icon, discount = lv_name, lv_icon, lv_discount
    return name, icon, discount


def _add_points(phone: str, earned: int, reason: str) -> dict[str, Any]:
    """‰∏∫Áî®Êà∑Â¢ûÂä†ÁßØÂàÜÔºåËøîÂõûÊúÄÊñ∞ÁßØÂàÜ‰ø°ÊÅØ"""
    all_points = _load_points()
    user = all_points.get(phone, {"points": 0, "total_earned": 0, "history": []})
    user["points"] = user.get("points", 0) + earned
    user["total_earned"] = user.get("total_earned", 0) + earned
    user["history"] = user.get("history", [])
    user["history"].insert(0, {
        "earned": earned,
        "reason": reason,
        "time": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
    })
    if len(user["history"]) > 50:
        user["history"] = user["history"][:50]
    level_name, level_icon, discount = _calc_level(user["total_earned"])
    user["level"] = level_name
    user["level_icon"] = level_icon
    user["discount"] = discount
    all_points[phone] = user
    _save_points(all_points)
    return user


# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ÂüéÂ∏Ç
# =============================================================================

CITIES: list[dict[str, Any]] = [
    {"id": "BJ", "name": "Âåó‰∫¨", "lat": 39.9042, "lng": 116.4074},
    {"id": "SH", "name": "‰∏äÊµ∑", "lat": 31.2304, "lng": 121.4737},
    {"id": "GZ", "name": "ÂπøÂ∑û", "lat": 23.1291, "lng": 113.2644},
    {"id": "CD", "name": "ÊàêÈÉΩ", "lat": 30.5728, "lng": 104.0668},
    {"id": "HZ", "name": "Êù≠Â∑û", "lat": 30.2741, "lng": 120.1551},
    {"id": "XA", "name": "Ë•øÂÆâ", "lat": 34.3416, "lng": 108.9398},
    {"id": "CQ", "name": "ÈáçÂ∫Ü", "lat": 29.4316, "lng": 106.9123},
    {"id": "KM", "name": "ÊòÜÊòé", "lat": 25.0389, "lng": 102.7183},
    {"id": "NJ", "name": "Âçó‰∫¨", "lat": 32.0603, "lng": 118.7969},
    {"id": "WH", "name": "Ê≠¶Ê±â", "lat": 30.5928, "lng": 114.3055},
]

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî Ëà±‰ΩçÁ≠âÁ∫ß
# =============================================================================

SEAT_CLASSES: list[dict[str, Any]] = [
    {"id": "business", "name": "ÂïÜÂä°Â∫ß", "icon": "üíé", "multiplier": 2.8,
     "desc": "Ë∂ÖÂÆΩÂ∫ßÊ§ÖÂèØ180¬∞Âπ≥Ë∫∫ÔºåÁã¨Á´ãÈòÖËØªÁÅØÔºåÂê´È§êÈ•ÆÊúçÂä°"},
    {"id": "first", "name": "‰∏ÄÁ≠âÂ∫ß", "icon": "ü•á", "multiplier": 1.6,
     "desc": "ÂÆΩÊïûÂ∫ßÊ§Ö2+2Â∏ÉÂ±ÄÔºåÂèØË∞ÉËäÇÈù†ËÉåÔºåÈÖçUSBÂÖÖÁîµ"},
    {"id": "second", "name": "‰∫åÁ≠âÂ∫ß", "icon": "üé´", "multiplier": 1.0,
     "desc": "Ê†áÂáÜÂ∫ßÊ§Ö3+2Â∏ÉÂ±ÄÔºåËàíÈÄÇÁªèÊµé‰πãÈÄâ"},
]

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ËΩ¶‰∏äÈ§êÈ£ü
# =============================================================================

MEAL_OPTIONS: list[dict[str, Any]] = [
    {"id": "none", "name": "‰∏çÈúÄË¶ÅÈ§êÈ£ü", "price": 0, "icon": "üö´", "desc": ""},
    {"id": "meal_a", "name": "Á∫¢ÁÉßÁâõËÇâÂ•óÈ§ê", "price": 45, "icon": "ü•©",
     "desc": "Á∫¢ÁÉßÁâõËÖ©+Á±≥È•≠+Êó∂Ëî¨+ÈÖ∏Â•∂"},
    {"id": "meal_b", "name": "Áï™ËåÑÈ∏°ËÇâÂ•óÈ§ê", "price": 40, "icon": "üçó",
     "desc": "Áï™ËåÑÁÇñÈ∏°+Á±≥È•≠+ÂáâËèú+ÊûúÊ±Å"},
    {"id": "meal_c", "name": "Á¥†È£üÂÖªÁîüÂ•óÈ§ê", "price": 35, "icon": "ü•ó",
     "desc": "ËèåËèáÊó∂Ëî¨+ÊùÇÁ≤ÆÈ•≠+Ë±ÜËÖêÁæπ+Ê∞¥Êûú"},
    {"id": "meal_d", "name": "ÂÑøÁ´•Ê¨¢‰πêÈ§ê", "price": 30, "icon": "üßí",
     "desc": "Ëø∑‰Ω†Ê±âÂ†°+ËñØÊù°+ÁéâÁ±≥ÊµìÊ±§+ÊûúÊ±Å"},
    {"id": "snack", "name": "Èõ∂È£üÈ•ÆÊñôÂåÖ", "price": 25, "icon": "üçø",
     "desc": "ÂùöÊûú+È•ºÂπ≤+ÁüøÊ≥âÊ∞¥+ÂíñÂï°/Ëå∂"},
]

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ÁæéÈ£üÊé®ËçêÔºàÊåâÂüéÂ∏ÇÔºâ
# =============================================================================

FOODS: dict[str, list[dict[str, Any]]] = {
    "BJ": [
        {"name": "ÂÖ®ËÅöÂæ∑ÁÉ§È∏≠", "type": "ËÄÅÂ≠óÂè∑", "rating": "4.8",
         "price_per_person": "168", "icon": "ü¶Ü",
         "address": "ÂâçÈó®Â§ßË°ó30Âè∑", "desc": "Âßã‰∫é1864Âπ¥ÔºåÊåÇÁÇâÁÉ§È∏≠ÁöÆËÑÜËÇâÂ´©ÔºåËò∏ÁîúÈù¢ÈÖ±Âç∑Ëç∑Âè∂È•ºÔºåÊ≠£ÂÆó‰∫¨Âë≥‰ª£Ë°®„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "ÁÉ§È∏≠"]},
        {"name": "Ê∂ÆËÇâ¬∑‰∏úÊù•È°∫", "type": "ÁÅ´ÈîÖ", "rating": "4.7",
         "price_per_person": "135", "icon": "üç≤",
         "address": "ÁéãÂ∫ú‰∫ïÂ§ßË°ó198Âè∑", "desc": "ÁôæÂπ¥ÈìúÈîÖÊ∂ÆËÇâÔºåÊâãÂàáÈ≤úÁæäËÇâËñÑÂ¶ÇÁ∫∏„ÄÅÂÖ•Âè£Âç≥ÂåñÔºåÈÖçËäùÈ∫ªÈÖ±ÊñôÁ¢üÁªùÈÖç„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "ÈìúÈîÖÊ∂ÆËÇâ"]},
        {"name": "Âåó‰∫¨ÁÇ∏ÈÖ±Èù¢¬∑Êµ∑Á¢óÂ±Ö", "type": "Èù¢È£ü", "rating": "4.5",
         "price_per_person": "38", "icon": "üçú",
         "address": "Â¢ûÂÖâË∑Ø11Âè∑", "desc": "Âú∞ÈÅìËÄÅÂåó‰∫¨ÁÇ∏ÈÖ±Èù¢ÔºåÈªÑÁìú‰∏ùËêùÂçú‰∏ùË±ÜËäΩËèúÁ†ÅÈΩêÂÖ®ÔºåÈÖ±È¶ôÊµìÈÉÅ„ÄÇ",
         "tags": ["Âπ≥‰ª∑ÁæéÂë≥", "Èù¢È£ü", "ËÄÅÂåó‰∫¨"]},
        {"name": "Êä§ÂõΩÂØ∫Â∞èÂêÉ", "type": "Â∞èÂêÉ", "rating": "4.3",
         "price_per_person": "25", "icon": "ü•ü",
         "address": "Êä§ÂõΩÂØ∫Â§ßË°ó93Âè∑", "desc": "Ë±åË±ÜÈªÑ„ÄÅÈ©¥ÊâìÊªö„ÄÅËâæÁ™ùÁ™ù„ÄÅÈù¢Ëå∂‚Ä¶‰∏ÄÁ´ôÂêÉÈÅçËÄÅÂåó‰∫¨‰º†ÁªüÂ∞èÂêÉ„ÄÇ",
         "tags": ["Âπ≥‰ª∑ÁæéÂë≥", "Â∞èÂêÉ", "‰º†Áªü"]},
    ],
    "SH": [
        {"name": "ÂçóÁøîÈ¶íÂ§¥Â∫ó", "type": "Â∞èÁ¨ºÂåÖ", "rating": "4.6",
         "price_per_person": "55", "icon": "ü•ü",
         "address": "Ë±´Âõ≠Ë∑Ø85Âè∑", "desc": "Âßã‰∫é1900Âπ¥ÔºåÁöÆËñÑÈ¶ÖÂ§ßÊ±§Ê±ÅÈ≤úÁæéÁöÑÂ∞èÁ¨ºÂåÖÔºåÂüéÈöçÂ∫ôÊéíÈòüÁéã„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "Â∞èÁ¨ºÂåÖ"]},
        {"name": "ÈºéÊ≥∞‰∏∞", "type": "Á≤æËá¥‰∏≠È§ê", "rating": "4.7",
         "price_per_person": "120", "icon": "ü•¢",
         "address": "Êñ∞Â§©Âú∞ÂçóÈáå", "desc": "Á±≥ÂÖ∂Êûó‰∏ÄÊòüÔºå18‰∏™Ë§∂ÁöÑÂ∞èÁ¨ºÂåÖÂå†ÂøÉ‰πã‰ΩúÔºåÊØèÂè™ÈáçÈáèÁ≤æÁ°ÆÂà∞ÂÖã„ÄÇ",
         "tags": ["Á±≥ÂÖ∂Êûó", "Á≤æËá¥È§êÈ•Æ", "Â∞èÁ¨ºÂåÖ"]},
        {"name": "ÈòøÂ§ßËë±Ê≤πÈ•º", "type": "Ë°óËæπÂ∞èÂêÉ", "rating": "4.5",
         "price_per_person": "15", "icon": "ü´ì",
         "address": "ËåÇÂêçÂçóË∑Ø159ÂºÑ", "desc": "Ë¢´BBCÁ∫™ÂΩïÁâáÊä•ÈÅìÁöÑÂºÑÂ†ÇÁæéÈ£üÔºåÂ§ñÈÖ•ÈáåÂ´©Ëë±È¶ôÂõõÊ∫¢„ÄÇ",
         "tags": ["ÁΩëÁ∫¢", "Âπ≥‰ª∑ÁæéÂë≥", "Ë°óËæπÂ∞èÂêÉ"]},
    ],
    "GZ": [
        {"name": "Èô∂Èô∂Â±Ö", "type": "Á≤§ËèúÊó©Ëå∂", "rating": "4.7",
         "price_per_person": "95", "icon": "ü´ñ",
         "address": "Á¨¨ÂçÅÁî´Ë∑Ø20Âè∑", "desc": "ÁôæÂπ¥ËÄÅÂ≠óÂè∑ÔºåËôæÈ•∫Áöá„ÄÅÂèâÁÉßÂåÖ„ÄÅËõãÊåûÊ†∑Ê†∑Á≤æÂìÅÔºåÂπøÂºèÊó©Ëå∂Â§©Ëä±Êùø„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "Êó©Ëå∂"]},
        {"name": "ÁÇ≥ËÉúÂìÅÂë≥", "type": "Á≤§Ëèú", "rating": "4.8",
         "price_per_person": "180", "icon": "ü¶ê",
         "address": "Áè†Ê±üÊñ∞ÂüéÂÖ¥Ê∞ëË∑Ø", "desc": "Á±≥ÂÖ∂Êûó‰∏ÄÊòüÁ≤§ËèúÔºåÁßòÂà∂ÈªëÂèâÁÉß„ÄÅËÑÜÁöÆÂèâÁÉßÊãºÁõòÊòØÊãõÁâåÂøÖÁÇπ„ÄÇ",
         "tags": ["Á±≥ÂÖ∂Êûó", "Á≤§Ëèú", "Á≤æËá¥È§êÈ•Æ"]},
        {"name": "ÂÆùÂçéÈù¢Â∫ó", "type": "Èù¢È£ü", "rating": "4.4",
         "price_per_person": "28", "icon": "üçú",
         "address": "ÂÆùÂçéË∑Ø117Âè∑", "desc": "ÊéíÈòüÊâçËÉΩÂêÉÂà∞ÁöÑ‰∫ëÂêûÈù¢ÔºåÈ≤úËôæ‰∫ëÂêûÁ≤íÁ≤íÈ•±Êª°ÔºåÁ´πÂçáÈù¢ÁàΩÊªëÂºπÁâô„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "Âπ≥‰ª∑ÁæéÂë≥", "‰∫ëÂêûÈù¢"]},
    ],
    "CD": [
        {"name": "Â∞èÈæôÂùéÁÅ´ÈîÖ", "type": "ÁÅ´ÈîÖ", "rating": "4.6",
         "price_per_person": "110", "icon": "üå∂Ô∏è",
         "address": "Êò•ÁÜôË∑ØÊ≠•Ë°åË°ó", "desc": "Ê≠£ÂÆóÂ∑ùÂë≥ÁÅ´ÈîÖÔºåÁâõÊ≤πÈîÖÂ∫ïÈ∫ªËæ£È≤úÈ¶ôÔºåÊØõËÇöÈ∏≠ËÇ†Ê∂ÆËµ∑Êù•Â∑¥ÈÄÇÂæóÂæà„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ÁÅ´ÈîÖ", "È∫ªËæ£"]},
        {"name": "ÈôàÈ∫ªÂ©ÜË±ÜËÖê", "type": "Â∑ùËèú", "rating": "4.5",
         "price_per_person": "55", "icon": "ü•ò",
         "address": "Ë•øÁéâÈæôË°ó197Âè∑", "desc": "È∫ªÂ©ÜË±ÜËÖêÂèëÊ∫êÂú∞ÔºåÈ∫ªËæ£ÁÉ´È≤úÂ´©ÈÖ•È¶ô‰∏ÄÈîÖÈõÜÈΩêÔºåÁôæÂπ¥‰º†ÊâøËÄÅÂë≥ÈÅì„ÄÇ",
         "tags": ["ËÄÅÂ≠óÂè∑", "Â∑ùËèú", "ÂøÖÂêÉÊ¶ú"]},
        {"name": "ÂªñËÆ∞Ê£íÊ£íÈ∏°", "type": "Â∞èÂêÉ", "rating": "4.4",
         "price_per_person": "35", "icon": "üêî",
         "address": "ÂèåÊ†ÖÂ≠êË°ó", "desc": "Á∫¢Ê≤πÊ£íÊ£íÈ∏°È∫ªËæ£È≤úÈ¶ôÔºåÈÖç‰∏äÁîúÊ∞¥Èù¢ÂíåÈíüÊ∞¥È•∫ÔºåÊàêÈÉΩÂë≥ÈÅìÂçÅË∂≥„ÄÇ",
         "tags": ["Âπ≥‰ª∑ÁæéÂë≥", "Â∞èÂêÉ", "ÊàêÈÉΩÂë≥ÈÅì"]},
    ],
    "HZ": [
        {"name": "Ê•ºÂ§ñÊ•º", "type": "Êù≠Â∏ÆËèú", "rating": "4.7",
         "price_per_person": "150", "icon": "üêü",
         "address": "Â≠§Â±±Ë∑Ø30Âè∑", "desc": "Âßã‰∫é1848Âπ¥ÔºåË•øÊπñÈÜãÈ±º„ÄÅÈæô‰∫ïËôæ‰ªÅ„ÄÅÂè´ÂåñÈ∏°ÔºåÊù≠Â∏ÆËèúÈõÜÂ§ßÊàê‰πãÊâÄ„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "Êù≠Â∏ÆËèú"]},
        {"name": "Áü•Âë≥ËßÇ", "type": "Â∞èÂêÉ", "rating": "4.5",
         "price_per_person": "45", "icon": "ü•ü",
         "address": "‰ªÅÂíåË∑Ø83Âè∑", "desc": "ÁôæÂπ¥ËÄÅÂ≠óÂè∑ÔºåÁå´ËÄ≥Êúµ„ÄÅÂ∞èÁ¨ºÂåÖ„ÄÅÂÆöËÉúÁ≥ïÔºåÊù≠Â∑û‰º†ÁªüÂ∞èÂêÉ‰∏ÄÁΩëÊâìÂ∞Ω„ÄÇ",
         "tags": ["ËÄÅÂ≠óÂè∑", "Â∞èÂêÉ", "‰º†Áªü"]},
    ],
    "XA": [
        {"name": "ËÄÅÂ≠ôÂÆ∂Ê≥°È¶ç", "type": "Ê≥°È¶ç", "rating": "4.6",
         "price_per_person": "48", "icon": "üçñ",
         "address": "‰∏úÂ§ßË°ó364Âè∑", "desc": "ÁôæÂπ¥ËÄÅÂ∫óÔºåÁæäËÇâÊ≥°È¶çÊñôÈáçÂë≥ÈÜáÔºåÊ±§È≤úËÇâÁÉÇÈ¶çÁ≠ãÈÅìÔºåË•øÂÆâÂøÖÂêÉ„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "Ê≥°È¶ç"]},
        {"name": "ÂõûÊ∞ëË°ó¬∑Ë¥æ‰∏âÁÅåÊ±§ÂåÖ", "type": "Â∞èÂêÉ", "rating": "4.5",
         "price_per_person": "35", "icon": "ü•ü",
         "address": "ÂõûÊ∞ëË°óÂåóÈô¢Èó®", "desc": "ÁöÆËñÑÊ±§Â§öÁöÑÁÅåÊ±§ÂåÖÂ≠êÔºåÈÖç‰∏äËæ£ÈÖ±ÂíåÈÜãÁ¢üÔºå‰∏ÄÂè£‰∏Ä‰∏™È≤ú„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "Â∞èÂêÉ", "ÁÅåÊ±§ÂåÖ"]},
        {"name": "ÈïøÂÆâÂ§ßÊéíÊ°£", "type": "ÈôïËèú", "rating": "4.6",
         "price_per_person": "85", "icon": "üçΩÔ∏è",
         "address": "Â§ßÂîê‰∏çÂ§úÂüé", "desc": "‰ªøÂè§Ë£Ö‰øÆÁöÑÈôïËèúÈ¶ÜÔºåbiangbiangÈù¢„ÄÅËÇâÂ§πÈ¶ç„ÄÅÂáâÁöÆ‰∏ÄÊ¨°Êª°Ë∂≥„ÄÇ",
         "tags": ["ÁΩëÁ∫¢", "ÈôïËèú", "Ê∞õÂõ¥Â•Ω"]},
    ],
    "CQ": [
        {"name": "ÁèÆÂßêËÄÅÁÅ´ÈîÖ", "type": "ÁÅ´ÈîÖ", "rating": "4.7",
         "price_per_person": "120", "icon": "üî•",
         "address": "Ëß£ÊîæÁ¢ëËæÉÂú∫Âè£", "desc": "ÈáçÂ∫ÜÁÅ´ÈîÖÊéíÈòüÁéãÔºåÁâõÊ≤πÈîÖÂ∫ïËæ£ËÄå‰∏çÁá•ÔºåÊØõËÇöÂíåÈ∫ªËæ£ÁâõËÇâÊòØÁÅµÈ≠Ç„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ÁÅ´ÈîÖ", "ÊéíÈòüÁéã"]},
        {"name": "Â±±ÂüéÂ∞èÊ±§ÂúÜ", "type": "Â∞èÂêÉ", "rating": "4.4",
         "price_per_person": "20", "icon": "üç°",
         "address": "ÂÖ´‰∏ÄË∑ØÂ•ΩÂêÉË°ó", "desc": "ÈÖíÈÖøÂ∞èÊ±§ÂúÜËΩØÁ≥ØÈ¶ôÁîúÔºåÈÖçÈÖ∏Ëæ£Á≤âÂíåÊäÑÊâãÔºåÂú∞ÈÅìÈáçÂ∫ÜÊó©È§ê„ÄÇ",
         "tags": ["Âπ≥‰ª∑ÁæéÂë≥", "Â∞èÂêÉ", "‰º†Áªü"]},
    ],
    "KM": [
        {"name": "Ê°•È¶ôÂõ≠ËøáÊ°•Á±≥Á∫ø", "type": "Á±≥Á∫ø", "rating": "4.5",
         "price_per_person": "42", "icon": "üçú",
         "address": "ÂÆùÂñÑË°ó", "desc": "Ê≠£ÂÆóËøáÊ°•Á±≥Á∫øÔºåÊªöÁÉ´È∏°Ê±§ÈÖç‰∏äÈ≤úËÇâÁâáÂíåÁ±≥Á∫øÔºå‰∫ëÂçóÁ¨¨‰∏ÄÁ¢óÂêç‰∏çËôö‰º†„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "Á±≥Á∫ø", "‰∫ëÂçóÂë≥"]},
        {"name": "‰∏ÄÈ¢óÂç∞¬∑‰∫ëÂçóËèú", "type": "ÊªáËèú", "rating": "4.6",
         "price_per_person": "88", "icon": "üçÑ",
         "address": "Áø†ÊπñÂçóË∑Ø", "desc": "Ê±ΩÈîÖÈ∏°„ÄÅËèåËèáÂÆ¥„ÄÅÈ≤úËä±È•ºÔºåÂú®ËÄÅÂÆÖÈô¢ÈáåÂìÅÂ∞ùÂú∞ÈÅì‰∫ëÂçóÂë≥„ÄÇ",
         "tags": ["Á≤æËá¥È§êÈ•Æ", "ÊªáËèú", "ËèåËèá"]},
    ],
    "NJ": [
        {"name": "Âçó‰∫¨Â§ßÁâåÊ°£", "type": "Ê∑ÆÊâ¨Ëèú", "rating": "4.6",
         "price_per_person": "75", "icon": "ü¶Ü",
         "address": "ÁãÆÂ≠êÊ°•2Âè∑", "desc": "ÁõêÊ∞¥È∏≠„ÄÅÈ∏≠Ë°ÄÁ≤â‰∏ùÊ±§„ÄÅÊ∞ëÂõΩÁæéÈæÑÁ≤•Ôºå‰∏ÄÁ´ôÂêÉÈÅçÂçó‰∫¨ÁªèÂÖ∏Âë≥ÈÅì„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "Ê∑ÆÊâ¨Ëèú", "Âçó‰∫¨Âë≥"]},
        {"name": "ÂõûÂë≥È∏≠Ë°ÄÁ≤â‰∏ùÊ±§", "type": "Â∞èÂêÉ", "rating": "4.4",
         "price_per_person": "18", "icon": "üç≤",
         "address": "Â§´Â≠êÂ∫ôÁæéÈ£üË°ó", "desc": "È∏≠Ë°ÄÂ´©Êªë„ÄÅÁ≤â‰∏ùÁàΩÂè£„ÄÅÈ∏≠ËÇùÈ∏≠ËÇ†ÈΩêÂÖ®ÔºåÂçó‰∫¨Ë°óÂ§¥Êó©È§ê‰πãÁéã„ÄÇ",
         "tags": ["Âπ≥‰ª∑ÁæéÂë≥", "Â∞èÂêÉ", "È∏≠Ë°ÄÁ≤â‰∏ù"]},
    ],
    "WH": [
        {"name": "Ëî°ÊûóËÆ∞ÁÉ≠Âπ≤Èù¢", "type": "Èù¢È£ü", "rating": "4.5",
         "price_per_person": "15", "icon": "üçú",
         "address": "Êà∑ÈÉ®Â∑∑", "desc": "ËäùÈ∫ªÈÖ±ÊãåÈù¢Êù°ÔºåÈÖç‰∏äÈÖ∏Ë±ÜËßíÂíåÈ¶ôËë±ÔºåÊ≠¶Ê±â‰∫∫ÁöÑÁÅµÈ≠ÇÊó©È§ê„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "ËÄÅÂ≠óÂè∑", "ÁÉ≠Âπ≤Èù¢"]},
        {"name": "ÈùìÈùìËí∏Ëôæ", "type": "Â∞èÈæôËôæ", "rating": "4.7",
         "price_per_person": "130", "icon": "ü¶û",
         "address": "‰∏áÊùæÂõ≠", "desc": "ËíúËìâËí∏Ëôæ„ÄÅÊ≤πÁÑñÂ§ßËôæÔºåÊ≠¶Ê±âÂ∞èÈæôËôæÂ§©Ëä±ÊùøÔºåÊó∫Â≠£ÊéíÈòü‰∏§Â∞èÊó∂„ÄÇ",
         "tags": ["ÂøÖÂêÉÊ¶ú", "Â∞èÈæôËôæ", "ÊéíÈòüÁéã"]},
    ],
}

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ÈÖíÂ∫óÊé®ËçêÔºàÊåâÂüéÂ∏ÇÔºâ
# =============================================================================

HOTELS: dict[str, list[dict[str, Any]]] = {
    "BJ": [
        {"name": "Âåó‰∫¨ÁéãÂ∫úÂçäÂ≤õÈÖíÂ∫ó", "stars": 5, "rating": "4.9",
         "price": "1680", "icon": "üè∞",
         "address": "ÁéãÂ∫ú‰∫ïÈáëÈ±ºËÉ°Âêå8Âè∑", "distance": "Ë∑ùÊïÖÂÆ´Ê≠•Ë°å15ÂàÜÈíü",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Âú∞ÈìÅÁõ¥Ëææ", "ÊïÖÂÆ´Âë®Ëæπ"],
         "desc": "ÂùêËêΩ‰∫éÁéãÂ∫ú‰∫ïÂïÜÂúàÊ†∏ÂøÉÔºåÂè§ÂÖ∏‰∏éÁé∞‰ª£ÂÆåÁæéËûçÂêàÔºåÊ≠•Ë°åÂèØËææÊïÖÂÆ´„ÄÇ"},
        {"name": "Âåó‰∫¨‰∏âÈáåÂ±Ø‰∫öÊúµÈÖíÂ∫ó", "stars": 4, "rating": "4.7",
         "price": "580", "icon": "üè®",
         "address": "‰∏âÈáåÂ±ØË∑Ø19Âè∑", "distance": "Ëøë‰∏âÈáåÂ±ØÂïÜÂúà",
         "tags": ["ÂìÅË¥®‰ºòÈÄâ", "ÂïÜÂúà‰æøÂà©", "ÊÄß‰ª∑ÊØîÈ´ò"],
         "desc": "Êó∂Â∞öÂïÜÂúàÈªÑÈáë‰ΩçÁΩÆÔºåÁ´πÂ±ÖÈòÖËØªÁ©∫Èó¥ÂíåÂ±ûÂú∞ÊëÑÂΩ±ÔºåÊñáËâ∫ËåÉÂçÅË∂≥„ÄÇ"},
        {"name": "Â¶ÇÂÆ∂Á≤æÈÄâ¬∑Â§©ÂÆâÈó®Â∫ó", "stars": 3, "rating": "4.3",
         "price": "320", "icon": "üõèÔ∏è",
         "address": "ÂâçÈó®‰∏úÂ§ßË°ó", "distance": "Ë∑ùÂ§©ÂÆâÈó®Ê≠•Ë°å10ÂàÜÈíü",
         "tags": ["ÁªèÊµéÂÆûÊÉ†", "‰ΩçÁΩÆÊûÅ‰Ω≥", "Âú∞ÈìÅÁõ¥Ëææ"],
         "desc": "ÁªèÊµéÂûãÈ¶ñÈÄâÔºåÁ¥ßÈÇªÂ§©ÂÆâÈó®ÂíåÂâçÈó®Â§ßË°óÔºåÂá∫Ë°åË¥≠Áâ©‰∏§‰∏çËØØ„ÄÇ"},
    ],
    "SH": [
        {"name": "‰∏äÊµ∑Â§ñÊª©ÂçéÂ∞îÈÅìÂ§´", "stars": 5, "rating": "4.9",
         "price": "2200", "icon": "üè∞",
         "address": "‰∏≠Â±±‰∏ú‰∏ÄË∑Ø2Âè∑", "distance": "Â§ñÊª©Ê†∏ÂøÉ‰ΩçÁΩÆ",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Â§ñÊª©ÊôØËßÇ", "ÁôæÂπ¥Âª∫Á≠ë"],
         "desc": "ÂùêÊã•Â§ñÊª©Áªù‰Ω≥Ê±üÊôØÔºåÂÖ•‰ΩèÁôæÂπ¥ÂéÜÂè≤Âª∫Á≠ëÔºåÂ•¢Âçé‰ΩìÈ™åÊó†‰∏é‰º¶ÊØî„ÄÇ"},
        {"name": "‰∏äÊµ∑ÈùôÂÆâCitiGOÈÖíÂ∫ó", "stars": 4, "rating": "4.6",
         "price": "490", "icon": "üè®",
         "address": "Áü≥Èó®‰∏ÄË∑Ø88Âè∑", "distance": "ËøëÂçó‰∫¨Ë•øË∑Ø",
         "tags": ["ÊΩÆÁâåÈÖíÂ∫ó", "‰∫§ÈÄö‰æøÂà©", "ÊÄß‰ª∑ÊØîÈ´ò"],
         "desc": "Âπ¥ËΩªÊΩÆÊµÅËÆæËÆ°È£éÊ†ºÔºåÊô∫ËÉΩÂÖ•‰Ωè‰ΩìÈ™åÔºåÁ¥ßÈÇªÂçó‰∫¨Ë∑ØÂïÜÂúà„ÄÇ"},
    ],
    "GZ": [
        {"name": "ÂπøÂ∑ûÁôΩÂ§©ÈπÖÂÆæÈ¶Ü", "stars": 5, "rating": "4.8",
         "price": "1280", "icon": "üè∞",
         "address": "Ê≤ôÈù¢ÂçóË°ó1Âè∑", "distance": "Ê≤ôÈù¢Â≤õ‰∏ä",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Áè†Ê±üÊôØËßÇ", "ÂéÜÂè≤ÂêçÂ∫ó"],
         "desc": "‰∏≠ÂõΩÈ¶ñÂÆ∂‰∫îÊòüÁ∫ßÈÖíÂ∫óÔºåÂùêËêΩÊ≤ôÈù¢Â≤õÔºåÁè†Ê±üÁæéÊôØ‰∏ÄËßàÊó†ÈÅó„ÄÇ"},
        {"name": "Áª¥‰πüÁ∫≥ÈÖíÂ∫ó¬∑ÂπøÂ∑ûÂ°îÂ∫ó", "stars": 3, "rating": "4.4",
         "price": "350", "icon": "üõèÔ∏è",
         "address": "Êñ∞Ê∏Ø‰∏≠Ë∑Ø354Âè∑", "distance": "ËøëÂπøÂ∑ûÂ°î",
         "tags": ["ÁªèÊµéÂÆûÊÉ†", "ËøëÂπøÂ∑ûÂ°î", "‰∫§ÈÄö‰æøÂà©"],
         "desc": "ÊØóÈÇªÂπøÂ∑ûÂ°îÂíåÁè†Ê±üÂ§úÊôØÔºåÂú∞ÈìÅÁõ¥ËææÔºåÂá∫Ë°åÊñπ‰æø‰ª∑Ê†º‰∫≤Ê∞ë„ÄÇ"},
    ],
    "CD": [
        {"name": "ÊàêÈÉΩÂçöËàçÈÖíÂ∫ó", "stars": 5, "rating": "4.9",
         "price": "1500", "icon": "üè∞",
         "address": "Á¨îÂ∏ñÂºèË°ó81Âè∑", "distance": "Â§™Âè§ÈáåÊóÅ",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Â§™Âè§ÈáåÊóÅ", "Âè§‰ªä‰∫§Ëûç"],
         "desc": "Èöê‰∫éÂ§™Âè§ÈáåÁöÑÂ•¢ÂçéÈÖíÂ∫óÔºåÊ∏Ö‰ª£Èô¢ËêΩ‰∏éÁé∞‰ª£ËÆæËÆ°ÂÆåÁæéËûçÂêà„ÄÇ"},
        {"name": "ÊàêÈÉΩÊáíÁå´ÈùíÂπ¥ÊóÖËàç", "stars": 2, "rating": "4.5",
         "price": "89", "icon": "üê±",
         "address": "ÂÆΩÁ™ÑÂ∑∑Â≠êÊóÅ", "distance": "Ê≠•Ë°å5ÂàÜÈíüËá≥ÂÆΩÁ™ÑÂ∑∑Â≠ê",
         "tags": ["ËÉåÂåÖÈ¶ñÈÄâ", "Ë∂ÖÈ´òÊÄß‰ª∑ÊØî", "Ê∞õÂõ¥Â•Ω"],
         "desc": "Âπ¥ËΩª‰∫∫ËÅöÈõÜÂú∞ÔºåËå∂È¶ÜÈ£éÊ†ºÂÖ¨ÂÖ±Âå∫Ôºå‰∫§ÂèãËÅäÂ§©ÊâìÁâåÂñùËå∂„ÄÇ"},
    ],
    "HZ": [
        {"name": "Êù≠Â∑ûË•øÂ≠êÊπñÂõõÂ≠£ÈÖíÂ∫ó", "stars": 5, "rating": "4.9",
         "price": "2800", "icon": "üè∞",
         "address": "ÁÅµÈöêË∑Ø5Âè∑", "distance": "Ë•øÊπñÁïî",
         "tags": ["È°∂Á∫ßÂ•¢Âçé", "Ë•øÊπñÊôØËßÇ", "Âõ≠ÊûóÈÖíÂ∫ó"],
         "desc": "Ë•øÊπñËæπÊúÄÁæéÈÖíÂ∫ó‰πã‰∏ÄÔºå‰∏≠ÂºèÂõ≠ÊûóËÆæËÆ°ÔºåÁ™óÂ§ñÂç≥ÊòØÊπñÂÖâÂ±±Ëâ≤„ÄÇ"},
        {"name": "ÂÖ®Â≠£ÈÖíÂ∫ó¬∑Ë•øÊπñÂ∫ó", "stars": 3, "rating": "4.5",
         "price": "420", "icon": "üè®",
         "address": "ÂçóÂ±±Ë∑Ø198Âè∑", "distance": "Ê≠•Ë°åËá≥Ë•øÊπñ5ÂàÜÈíü",
         "tags": ["ÂìÅË¥®‰ºòÈÄâ", "Ë•øÊπñÊ≠•Ë°åÂèØËææ", "ÊÄß‰ª∑ÊØîÈ´ò"],
         "desc": "Á¥ßÈÇªË•øÊπñÂçóÂ±±Ë∑ØÔºåÊ≠•Ë°åÂç≥ËææÈõ∑Â≥∞Â°îÂíåËä±Ê∏ØËßÇÈ±º„ÄÇ"},
    ],
    "XA": [
        {"name": "Ë•øÂÆâWÈÖíÂ∫ó", "stars": 5, "rating": "4.8",
         "price": "1380", "icon": "üè∞",
         "address": "È´òÊñ∞Âå∫ÁßëÊäÄË∑Ø", "distance": "Â§ßÈõÅÂ°îËΩ¶Á®ã15ÂàÜÈíü",
         "tags": ["Ë±™Âçé‰∫îÊòü", "ÊΩÆÊµÅËÆæËÆ°", "ÁΩëÁ∫¢ÈÖíÂ∫ó"],
         "desc": "ÊΩÆÊµÅ‰∏éÂè§ÈÉΩÁ¢∞ÊíûÔºåWETÊ≥≥Ê±†Ê¥æÂØπÂíåAWAYÊ∞¥ÁñóÊòØ‰∫ÆÁÇπ„ÄÇ"},
        {"name": "Ë•øÂÆâÈíüÊ•ºÁæéÂ±ÖÈÖíÂ∫ó", "stars": 4, "rating": "4.6",
         "price": "480", "icon": "üè®",
         "address": "ÂåóÂ§ßË°ó1Âè∑", "distance": "ÈíüÊ•ºÊóÅ",
         "tags": ["‰ΩçÁΩÆÁªù‰Ω≥", "ÈíüÊ•ºÊóÅ", "Ê≥ïÂºèÊ†ºË∞É"],
         "desc": "Á¥ßÈÇªÈíüÊ•ºÈºìÊ•ºÔºåÊ≠•Ë°åÂèØËææÂõûÊ∞ëË°óÔºåËßàÂè§ÂüéÁπÅÂçé„ÄÇ"},
    ],
    "CQ": [
        {"name": "ÈáçÂ∫Ü‰∏ΩÊô∂ÈÖíÂ∫ó", "stars": 5, "rating": "4.8",
         "price": "1100", "icon": "üè∞",
         "address": "Ëß£ÊîæÁ¢ëÊ∞ëÊùÉË∑Ø", "distance": "ËøëÊ¥™Â¥ñÊ¥û",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Ê±üÊôØÂÆ¢Êàø", "Ëß£ÊîæÁ¢ëÊóÅ"],
         "desc": "ÂùêÊã•‰∏§Ê±ü‰∫§Ê±áÊôØËßÇÔºåÊ≠•Ë°åÂèØËææËß£ÊîæÁ¢ëÂíåÊ¥™Â¥ñÊ¥û„ÄÇ"},
        {"name": "ÈÄîÂÆ∂Ê∞ëÂÆø¬∑Ê±üÊôØÊàø", "stars": 3, "rating": "4.6",
         "price": "280", "icon": "üè†",
         "address": "ÂçóÊª®Ë∑Ø", "distance": "Ê≠£ÂØπÊ¥™Â¥ñÊ¥û",
         "tags": ["Ê±üÊôØÊ∞ëÂÆø", "ÊãçÁÖßÁªù‰Ω≥", "ÊÄß‰ª∑ÊØîÈ´ò"],
         "desc": "ÂçóÊª®Ë∑ØÊ±üÊôØÊ∞ëÂÆøÔºåËêΩÂú∞Á™óÊ≠£ÂØπÊ¥™Â¥ñÊ¥ûÂ§úÊôØÔºåÁΩëÁ∫¢ÊãçÁÖßÊú∫‰Ωç„ÄÇ"},
    ],
    "KM": [
        {"name": "ÊòÜÊòéÊ¥≤ÈôÖÈÖíÂ∫ó", "stars": 5, "rating": "4.7",
         "price": "880", "icon": "üè∞",
         "address": "ÊªáÊ±†Ë∑Ø576Âè∑", "distance": "ËøëÊªáÊ±†",
         "tags": ["Ë±™Âçé‰∫îÊòü", "ÊªáÊ±†ÊôØËßÇ", "ÂõõÂ≠£Â¶ÇÊò•"],
         "desc": "Á¥ßÈÇªÊªáÊ±†Êµ∑ÂüÇÂÖ¨Âõ≠ÔºåÂÜ¨Â≠£Âú®Èò≥Âè∞Â∞±ËÉΩÁúãÁ∫¢Âò¥È∏•È£ûÁøî„ÄÇ"},
    ],
    "NJ": [
        {"name": "Âçó‰∫¨Ê∂µÁ¢ßÊ•ºÈÖíÂ∫ó", "stars": 5, "rating": "4.8",
         "price": "1600", "icon": "üè∞",
         "address": "Êâ¨Â≠êÊ±üÂ§ßÈÅì208Âè∑", "distance": "Êª®Ê±ü‰ΩçÁΩÆ",
         "tags": ["Ë±™Âçé‰∫îÊòü", "ÈïøÊ±üÊôØËßÇ", "ËÆæËÆ°ÈÖíÂ∫ó"],
         "desc": "ÈïøÊ±ü‰πãÁïîÁöÑÈ°∂Á∫ßËÆæËÆ°ÈÖíÂ∫óÔºåÂ§ßÈù¢ÁßØËêΩÂú∞Á™óËµèÈïøÊ±üÊó•ËêΩ„ÄÇ"},
        {"name": "‰∫öÊúµÈÖíÂ∫ó¬∑Â§´Â≠êÂ∫ôÂ∫ó", "stars": 4, "rating": "4.6",
         "price": "430", "icon": "üè®",
         "address": "Â§´Â≠êÂ∫ôÈôÑËøë", "distance": "Ê≠•Ë°å3ÂàÜÈíüËá≥Â§´Â≠êÂ∫ô",
         "tags": ["ÂìÅË¥®‰ºòÈÄâ", "Â§´Â≠êÂ∫ôÊóÅ", "Áß¶Ê∑ÆÂ§úÊôØ"],
         "desc": "Â§´Â≠êÂ∫ôÊ†∏ÂøÉ‰ΩçÁΩÆÔºåÂá∫Èó®Âç≥ÊòØÁß¶Ê∑ÆÊ≤≥ÁïîÁÅØÁÅ´ÈòëÁèä„ÄÇ"},
    ],
    "WH": [
        {"name": "Ê≠¶Ê±âÂÖâË∞∑ÂáØÊÇ¶ÈÖíÂ∫ó", "stars": 5, "rating": "4.7",
         "price": "780", "icon": "üè∞",
         "address": "È´òÊñ∞Â§ßÈÅì666Âè∑", "distance": "Ëøë‰∏úÊπñ",
         "tags": ["Ë±™Âçé‰∫îÊòü", "Ëøë‰∏úÊπñ", "ÂïÜÂä°‰ºëÈó≤"],
         "desc": "ÂÖâË∞∑Âú∞Ê†áÈÖíÂ∫óÔºåÊØóÈÇª‰∏úÊπñÁªøÈÅìÔºåÊ®±Ëä±Â≠£ÂÖ•‰ΩèÈ¶ñÈÄâ„ÄÇ"},
        {"name": "Ê±âÂ∫≠ÈÖíÂ∫ó¬∑Êà∑ÈÉ®Â∑∑Â∫ó", "stars": 3, "rating": "4.3",
         "price": "240", "icon": "üõèÔ∏è",
         "address": "Ê≠¶ÊòåÂå∫‰∏≠ÂçéË∑Ø", "distance": "Ê≠•Ë°åËá≥Êà∑ÈÉ®Â∑∑3ÂàÜÈíü",
         "tags": ["ÁªèÊµéÂÆûÊÉ†", "Êà∑ÈÉ®Â∑∑ÊóÅ", "ÈªÑÈπ§Ê•ºÂë®Ëæπ"],
         "desc": "Á¥ßÈÇªÊà∑ÈÉ®Â∑∑ÂíåÈªÑÈπ§Ê•ºÔºåÂìÅÂ∞ùÁæéÈ£üÂíåÊ∏∏ËßàÂêçËÉú‰∏§‰∏çËØØ„ÄÇ"},
    ],
}

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ÊôØÁÇπÔºà‰øùÊåÅÂéüÊúâÊï∞ÊçÆ‰∏çÂèòÔºåÊ≠§Â§ÑÁúÅÁï•ËµãÂÄºÔºå‰øùÁïôÂºïÁî®Ôºâ
# =============================================================================

ATTRACTIONS: dict[str, list[dict[str, Any]]] = {
    "BJ": [
        {
            "id": "bj_gugong",
            "name": "ÊïÖÂÆ´ÂçöÁâ©Èô¢",
            "image": "https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?w=600",
            "gallery": [
                "https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?w=800",
                "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800",
                "https://images.unsplash.com/photo-1547981609-4b6bfe67ca0b?w=800",
            ],
            "desc": "‰∏ñÁïå‰∏äÁé∞Â≠òËßÑÊ®°ÊúÄÂ§ß„ÄÅ‰øùÂ≠òÊúÄÂÆåÊï¥ÁöÑÊú®Ë¥®ÁªìÊûÑÂè§Âª∫Á≠ëÁæ§ÔºåË¢´Ë™â‰∏∫‰∏ñÁïå‰∫îÂ§ßÂÆ´‰πãÈ¶ñ„ÄÇ",
            "detail": "ÊïÖÂÆ´ÂèàÁß∞Á¥´Á¶ÅÂüéÔºåÂç†Âú∞72‰∏áÂπ≥ÊñπÁ±≥ÔºåÂª∫Á≠ëÈù¢ÁßØÁ∫¶15‰∏áÂπ≥ÊñπÁ±≥ÔºåÊã•ÊúâÊÆøÂÆá9999Èó¥ÂçäÔºåÊòØÊòéÊ∏Ö‰∏§Êúù24‰ΩçÁöáÂ∏ùÁöÑÁöáÂÆ´„ÄÇ1987Âπ¥Ë¢´ËÅîÂêàÂõΩÊïôÁßëÊñáÁªÑÁªáÂàó‰∏∫‰∏ñÁïåÊñáÂåñÈÅó‰∫ß„ÄÇ",
            "rating": "5.0", "ticket_price": "60",
            "open_time": "Êó∫Â≠£ 08:30-17:00ÔºõÊ∑°Â≠£ 08:30-16:30ÔºõÂë®‰∏ÄÈó≠È¶Ü",
            "address": "Âåó‰∫¨Â∏Ç‰∏úÂüéÂå∫ÊôØÂ±±ÂâçË°ó4Âè∑",
            "tips": ["Âª∫ËÆÆÊèêÂâçÂú®ÂÆòÁΩëÈ¢ÑÁ∫¶Èó®Á•®", "ÂÖ®Á®ãÊ≠•Ë°åÁ∫¶ÈúÄ3-4Â∞èÊó∂", "ÁèçÂÆùÈ¶ÜÂíåÈíüË°®È¶ÜÈúÄÂè¶Ë¥≠Èó®Á•®", "Êé®Ëçê‰ªéÂçàÈó®Ëøõ„ÄÅÁ•ûÊ≠¶Èó®Âá∫"],
        },
        {
            "id": "bj_changcheng", "name": "ÈïøÂüé¬∑ÂÖ´ËææÂ≤≠",
            "image": "https://images.unsplash.com/photo-1508804185872-d7badad00f7d?w=600",
            "gallery": ["https://images.unsplash.com/photo-1508804185872-d7badad00f7d?w=800", "https://images.unsplash.com/photo-1549888834-3ec93abae044?w=800", "https://images.unsplash.com/photo-1597655601841-214a4cfe8b2c?w=800"],
            "desc": "‰∏áÈáåÈïøÂüéÊúÄÂÖ∑‰ª£Ë°®ÊÄßÁöÑÁ≤æÂçéÂú∞ÊÆµ„ÄÇ",
            "detail": "ÂÖ´ËææÂ≤≠ÈïøÂüé‰Ωç‰∫éÂåó‰∫¨Â∏ÇÂª∂Â∫ÜÂå∫ÔºåÊµ∑ÊãîÈ´òËææ1015Á±≥ÔºåÊòØÊñ∞‰∏≠ÂõΩÊàêÁ´ãÂêéÁ¨¨‰∏Ä‰∏™ÂØπÂ§ñÂºÄÊîæÁöÑÊóÖÊ∏∏ÊôØÂå∫„ÄÇ",
            "rating": "4.9", "ticket_price": "40",
            "open_time": "Êó∫Â≠£ 06:30-19:00ÔºõÊ∑°Â≠£ 07:30-18:00",
            "address": "Âåó‰∫¨Â∏ÇÂª∂Â∫ÜÂå∫G6‰∫¨ËóèÈ´òÈÄü58Âè∑Âá∫Âè£",
            "tips": ["Âª∫ËÆÆÈÄâÊã©ÂåóÊÆµÊîÄÁôª", "ÂèØ‰πòÁºÜËΩ¶Âà∞ÂåóÂÖ´Ê•º", "ÁßãÂ≠£Á∫¢Âè∂ÊúÄ‰Ω≥", "ÈÅøÂºÄÂõΩÂ∫ÜÈ´òÂ≥∞"],
        },
        {
            "id": "bj_yiheyuan", "name": "È¢êÂíåÂõ≠",
            "image": "https://images.unsplash.com/photo-1547981609-4b6bfe67ca0b?w=600",
            "gallery": ["https://images.unsplash.com/photo-1547981609-4b6bfe67ca0b?w=800", "https://images.unsplash.com/photo-1596394516093-501ba68a0ba6?w=800", "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800"],
            "desc": "‰∏≠ÂõΩÁé∞Â≠òÊúÄÂ§ßÁöÑÁöáÂÆ∂Âõ≠ÊûóÔºå1998Âπ¥Âàó‰∏∫‰∏ñÁïåÊñáÂåñÈÅó‰∫ß„ÄÇ",
            "detail": "È¢êÂíåÂõ≠‰ª•ÊòÜÊòéÊπñÂíå‰∏áÂØøÂ±±‰∏∫Âü∫Á°ÄÔºå‰ª•Êù≠Â∑ûË•øÊπñÈ£éÊôØ‰∏∫ËìùÊú¨ËÄåÂª∫„ÄÇÈïøÂªäÂÖ®Èïø728Á±≥ÔºåÂÖ±273Èó¥„ÄÇ",
            "rating": "4.8", "ticket_price": "30",
            "open_time": "Êó∫Â≠£ 06:30-18:00ÔºõÊ∑°Â≠£ 07:00-17:00",
            "address": "Âåó‰∫¨Â∏ÇÊµ∑Ê∑ÄÂå∫Êñ∞Âª∫ÂÆ´Èó®Ë∑Ø19Âè∑",
            "tips": ["ÊòÜÊòéÊπñÂèØ‰πòÊ∏∏Ëàπ", "ÈïøÂªäÂΩ©ÁªòÂÄºÂæóÁªÜÁúã", "ËãèÂ∑ûË°óÈúÄÂè¶Ë¥≠Èó®Á•®", "‰∏úÂÆ´Èó®ÂÖ•Âõ≠ÊúÄ‰Ω≥"],
        },
    ],
    "SH": [
        {"id": "sh_waitan", "name": "Â§ñÊª©", "image": "https://images.unsplash.com/photo-1545893835-abaa50cbe628?w=600", "gallery": ["https://images.unsplash.com/photo-1545893835-abaa50cbe628?w=800", "https://images.unsplash.com/photo-1538428494232-9c0d8a3ab403?w=800", "https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=800"], "desc": "‰∏áÂõΩÂª∫Á≠ëÂçöËßàÁæ§Ôºå‰∏äÊµ∑ÊúÄÁªèÂÖ∏ÁöÑÂüéÂ∏ÇÊôØËßÇ„ÄÇ", "detail": "Â§ñÊª©ÂÖ®Èïø1.5ÂÖ¨ÈáåÔºåÁüóÁ´ãÁùÄ52Âπ¢È£éÊ†ºËø•ÂºÇÁöÑÂè§ÂÖ∏Â§çÂÖ¥Â§ßÊ•º„ÄÇ", "rating": "4.8", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "‰∏äÊµ∑Â∏ÇÈªÑÊµ¶Âå∫‰∏≠Â±±‰∏ú‰∏ÄË∑Ø", "tips": ["ÂÇçÊôöÁúãÊó•ËêΩÂíåÂ§úÊôØ", "Âë®Êú´‰∫∫Â§öÂª∫ËÆÆÂ∑•‰ΩúÊó•", "Âçó‰∫¨Ë∑ØÊ≠•Ë°åË°óÂèØ‰∏ÄÂπ∂Ê∏∏Ëßà", "ÂØπÂ≤∏ÈôÜÂÆ∂Âò¥Â§úÊôØÁªùÁæé"]},
        {"id": "sh_dongfangmingzhu", "name": "‰∏úÊñπÊòéÁè†", "image": "https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=600", "gallery": ["https://images.unsplash.com/photo-1548919973-5cef591cdbc9?w=800", "https://images.unsplash.com/photo-1536599424071-0b215a388ba7?w=800", "https://images.unsplash.com/photo-1538428494232-9c0d8a3ab403?w=800"], "desc": "‰∏äÊµ∑Ê†áÂøóÊÄßÂª∫Á≠ëÔºåÂ°îÈ´òÁ∫¶468Á±≥„ÄÇ", "detail": "‰∏úÊñπÊòéÁè†ÂπøÊí≠ÁîµËßÜÂ°î‰Ωç‰∫éÊµ¶‰∏úÊñ∞Âå∫ÈôÜÂÆ∂Âò¥Ôºå259Á±≥ÂÖ®ÈÄèÊòéÊÇ¨Á©∫ËßÇÂÖâÂªä‰ª§‰∫∫ÈúáÊíº„ÄÇ", "rating": "4.6", "ticket_price": "120", "open_time": "09:00-21:00", "address": "‰∏äÊµ∑Â∏ÇÊµ¶‰∏úÊñ∞Âå∫‰∏ñÁ∫™Â§ßÈÅì1Âè∑", "tips": ["Âª∫ËÆÆ‰π∞Âê´ÊÇ¨Á©∫ËßÇÂÖâÂªäÂ•óÁ•®", "B1Â±ÇÂéÜÂè≤ÈôàÂàóÈ¶ÜÂÄºÂæóÁúã", "‰∏ãÂçà3-4ÁÇπÂèØÁúãÊó•ÊôØÂíåÂ§úÊôØ", "ÊóãËΩ¨È§êÂéÖÈúÄÊèêÂâçÈ¢ÑÁ∫¶"]},
    ],
    "GZ": [
        {"id": "gz_guangzhoutower", "name": "ÂπøÂ∑ûÂ°î", "image": "https://images.unsplash.com/photo-1583394293214-28ded15ee548?w=600", "gallery": ["https://images.unsplash.com/photo-1583394293214-28ded15ee548?w=800", "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=800", "https://images.unsplash.com/photo-1536599424071-0b215a388ba7?w=800"], "desc": "\"Â∞èËõÆËÖ∞\"ÔºåÊÄªÈ´ò600Á±≥Ôºå‰∏≠ÂõΩÁ¨¨‰∏ÄÈ´òÂ°î„ÄÇ", "detail": "ÂπøÂ∑ûÂ°îÈõÜÊóÖÊ∏∏ËßÇÂÖâ„ÄÅÈ§êÈ•Æ„ÄÅÊñáÂåñÂ®±‰πê‰∫é‰∏Ä‰ΩìÔºå488Á±≥Êà∑Â§ñËßÇÊôØÂπ≥Âè∞‰∏ñÁïåÊúÄÈ´ò„ÄÇ", "rating": "4.7", "ticket_price": "150", "open_time": "09:30-22:30", "address": "ÂπøÂ∑ûÂ∏ÇÊµ∑Áè†Âå∫ÈòÖÊ±üË•øË∑Ø222Âè∑", "tips": ["ÂÇçÊôö‰∏äÂ°îÁúãÊó•ËêΩÂíåÁè†Ê±üÂ§úÊôØ", "450Á±≥Êë©Â§©ËΩÆ‰∏ñÁïåÊúÄÈ´ò", "Â°îÂ∫ïÂÖçË¥πÁÅØÂÖâÁßÄ", "488Á±≥Âπ≥Âè∞È£éÂ§ßÊ≥®ÊÑè‰øùÊöñ"]},
        {"id": "gz_chenjiaci", "name": "ÈôàÂÆ∂Á•†", "image": "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=600", "gallery": ["https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=800", "https://images.unsplash.com/photo-1583394293214-28ded15ee548?w=800", "https://images.unsplash.com/photo-1516026672322-bc52d61a55d5?w=800"], "desc": "Â≤≠ÂçóÂª∫Á≠ëËâ∫ÊúØÊòéÁè†ÔºåÁ≤æÊπõË£ÖÈ•∞Â∑•Ëâ∫ËëóÁß∞„ÄÇ", "detail": "Âª∫‰∫éÊ∏ÖÂÖâÁª™Âπ¥Èó¥ÔºåÈõÜÂπø‰∏úÊ∞ëÈó¥Êú®Èõï„ÄÅÁü≥Èõï„ÄÅÁ†ñÈõï„ÄÅÁÅ∞Â°ë„ÄÅÈô∂Â°ëÁ≠âË£ÖÈ•∞Ëâ∫ÊúØ‰πãÂ§ßÊàê„ÄÇ", "rating": "4.6", "ticket_price": "10", "open_time": "09:00-17:30", "address": "ÂπøÂ∑ûÂ∏ÇËçîÊπæÂå∫‰∏≠Â±±‰∏ÉË∑ØÊÅ©ÈæôÈáå34Âè∑", "tips": ["Â±ãÈ°∂Èô∂Â°ëËÑäÈ•∞ÊòØ‰∫ÆÁÇπ", "Âª∫ËÆÆÈ¢ÑÁïô1.5-2Â∞èÊó∂", "Âú∞ÈìÅ1Âè∑Á∫øÈôàÂÆ∂Á•†Á´ôDÂè£", "È¶ÜÂÜÖÊúâÂπøÁª£Á≠âÁ≤æÂìÅÂ±ïËßà"]},
    ],
    "CD": [
        {"id": "cd_panda", "name": "Â§ßÁÜäÁå´ÁπÅËÇ≤Á†îÁ©∂Âü∫Âú∞", "image": "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=600", "gallery": ["https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=800", "https://images.unsplash.com/photo-1525382455947-f319bc05fb35?w=800", "https://images.unsplash.com/photo-1527118732049-c88155f2107c?w=800"], "desc": "‰∏ñÁïåËëóÂêçÁöÑÂ§ßÁÜäÁå´‰øùÊä§Âü∫Âú∞ÔºåÂèØËøëË∑ùÁ¶ªËßÇËµèÂ§ßÁÜäÁå´„ÄÇ", "detail": "Âç†Âú∞1000‰∫©ÔºåÈô§Â§ßÁÜäÁå´Â§ñËøòÊúâÂ∞èÁÜäÁå´„ÄÅÈªëÈ¢àÈπ§Á≠âÁèçÁ®ÄÂä®Áâ©„ÄÇÊúà‰∫Æ‰∫ßÊàøÂèØÁúãÁÜäÁå´ÂÆùÂÆù„ÄÇ", "rating": "4.9", "ticket_price": "55", "open_time": "07:30-18:00", "address": "ÊàêÈÉΩÂ∏ÇÊàêÂçéÂå∫ÁÜäÁå´Â§ßÈÅì1375Âè∑", "tips": ["Âª∫ËÆÆ7:30ÂºÄÈó®Â∞±ÂÖ•Âõ≠", "Êúà‰∫Æ‰∫ßÊàøÂøÖÂéª", "Âõ≠Âå∫Â§ßÂª∫ËÆÆÂùêËßÇÂÖâËΩ¶", "‰∏ãÂçàÁÜäÁå´Â§öÂú®Áù°Ëßâ"]},
        {"id": "cd_kuanzhai", "name": "ÂÆΩÁ™ÑÂ∑∑Â≠ê", "image": "https://images.unsplash.com/photo-1527118732049-c88155f2107c?w=600", "gallery": ["https://images.unsplash.com/photo-1527118732049-c88155f2107c?w=800", "https://images.unsplash.com/photo-1564349683136-77e08dba1ef7?w=800", "https://images.unsplash.com/photo-1525382455947-f319bc05fb35?w=800"], "desc": "ÊàêÈÉΩÊúÄÂÖ∑‰ª£Ë°®ÊÄßÁöÑÂéÜÂè≤ÊñáÂåñË°óÂå∫„ÄÇ", "detail": "Áî±ÂÆΩÂ∑∑Â≠ê„ÄÅÁ™ÑÂ∑∑Â≠êÂíå‰∫ïÂ∑∑Â≠ê‰∏âÊù°ËÄÅÂºèË°óÈÅìÁªÑÊàêÔºåÊ±áÈõÜÁæéÈ£ü„ÄÅÊâãÂ∑•Ëâ∫ÂìÅÂíåËå∂È¶ÜÊñáÂåñ„ÄÇ", "rating": "4.5", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "ÊàêÈÉΩÂ∏ÇÈùíÁæäÂå∫Âêå‰ªÅË∑Ø‰ª•‰∏ú", "tips": ["ÂÖçË¥πÊôØÂå∫‰ΩÜÁæéÈ£üÈúÄ‰ªòË¥π", "Âª∫ËÆÆ‰∏ãÂçàÂà∞Êôö‰∏äÂâçÊù•", "Âë®Ëæπ‰∫∫Ê∞ëÂÖ¨Âõ≠‰ΩìÈ™åËå∂È¶Ü", "ËäÇÂÅáÊó•‰∫∫Â§öÂª∫ËÆÆÂ∑•‰ΩúÊó•"]},
    ],
    "HZ": [
        {"id": "hz_xihu", "name": "Ë•øÊπñ", "image": "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=600", "gallery": ["https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800", "https://images.unsplash.com/photo-1598887142487-3c854d51eabb?w=800", "https://images.unsplash.com/photo-1588668214407-6ea9a6d8c272?w=800"], "desc": "‰∏ñÁïåÊñáÂåñÈÅó‰∫ßÔºå\"Ê∑°Â¶ÜÊµìÊäπÊÄªÁõ∏ÂÆú\"„ÄÇ", "detail": "Ë•øÊπñÂçÅÊôØÂêÑÂÖ∑ÁâπËâ≤ÔºåÂõõÂ≠£È£éÂÖâ‰∏çÂêå„ÄÇ2011Âπ¥Âàó‰∏∫‰∏ñÁïåÊñáÂåñÈÅó‰∫ß„ÄÇ", "rating": "5.0", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "Êù≠Â∑ûÂ∏ÇË•øÊπñÂå∫Èæô‰∫ïË∑Ø1Âè∑", "tips": ["‰∏âÊΩ≠Âç∞ÊúàÈúÄ‰πòËàπ55ÂÖÉ", "È™ëË°åÁéØÊπñÁ∫¶15ÂÖ¨Èáå", "Êñ≠Ê°•ÊÆãÈõ™ÂÜ¨Â≠£ÊúÄÁæé", "Èõ∑Â≥∞Â°îÁôªÈ°∂‰øØÁû∞ÂÖ®ÊôØ"]},
        {"id": "hz_lingyin", "name": "ÁÅµÈöêÂØ∫", "image": "https://images.unsplash.com/photo-1518855706573-84de4022b69b?w=600", "gallery": ["https://images.unsplash.com/photo-1518855706573-84de4022b69b?w=800", "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800", "https://images.unsplash.com/photo-1588668214407-6ea9a6d8c272?w=800"], "desc": "ÂßãÂª∫‰∫é326Âπ¥ÔºåËøë1700Âπ¥ÂéÜÂè≤ÔºåÁ¶ÖÂÆóÂçÅÂ§ßÂè§Âàπ‰πã‰∏Ä„ÄÇ", "detail": "ÁÅµÈöêÂØ∫‰Ωç‰∫éÈ£ûÊù•Â≥∞ÂíåÂåóÈ´òÂ≥∞‰πãÈó¥ÔºåÈ£ûÊù•Â≥∞‰∏äÊúâ‰∫î‰ª£Ëá≥ÂÆãÂÖÉÁü≥Á™üÈÄ†ÂÉè300‰ΩôÂ∞ä„ÄÇ", "rating": "4.7", "ticket_price": "30", "open_time": "07:00-18:15", "address": "Êù≠Â∑ûÂ∏ÇË•øÊπñÂå∫ÁÅµÈöêË∑ØÊ≥ï‰∫ëÂºÑ1Âè∑", "tips": ["È£ûÊù•Â≥∞ÊôØÂå∫45ÂÖÉ+ÁÅµÈöêÂØ∫30ÂÖÉ", "È£ûÊù•Â≥∞Áü≥Á™üÈÄ†ÂÉèÂøÖÁúã", "Ê∞∏Á¶èÁ¶ÖÂØ∫‰∫∫Â∞ëÊôØÁæé", "Âàù‰∏ÄÂçÅ‰∫î‰∫∫Â§öÂª∫ËÆÆÈÅøÂºÄ"]},
    ],
    "XA": [
        {"id": "xa_bingmayong", "name": "ÂÖµÈ©¨‰øë", "image": "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=600", "gallery": ["https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=800", "https://images.unsplash.com/photo-1552083375-1447ce886485?w=800", "https://images.unsplash.com/photo-1564577160324-112d603f750f?w=800"], "desc": "‰∏ñÁïåÁ¨¨ÂÖ´Â§ßÂ•áËøπ„ÄÇ", "detail": "1974Âπ¥ÂèëÁé∞ÔºåÂÖ±Âá∫ÂúüÈô∂‰øë„ÄÅÈô∂È©¨8000‰Ωô‰ª∂ÔºåÊØè‰∏™Èù¢ÈÉ®Ë°®ÊÉÖÂêÑ‰∏çÁõ∏Âêå„ÄÇ", "rating": "5.0", "ticket_price": "120", "open_time": "Êó∫Â≠£ 08:30-18:00ÔºõÊ∑°Â≠£ 08:30-16:30", "address": "Ë•øÂÆâÂ∏Ç‰∏¥ÊΩºÂå∫Áß¶ÈôµÂåóË∑Ø", "tips": ["Âª∫ËÆÆËØ∑ËÆ≤Ëß£Âëò", "‰∏ÄÂè∑Âùë‚Üí‰∏âÂè∑Âùë‚Üí‰∫åÂè∑ÂùëÈ°∫Â∫è", "ÈìúËΩ¶È©¨Â±ïÂéÖÂøÖÁúã", "Ê∏∏5/306Ë∑ØÁõ¥Ëææ"]},
        {"id": "xa_dayanta", "name": "Â§ßÈõÅÂ°î", "image": "https://images.unsplash.com/photo-1564577160324-112d603f750f?w=600", "gallery": ["https://images.unsplash.com/photo-1564577160324-112d603f750f?w=800", "https://images.unsplash.com/photo-1545569341-9eb8b30979d9?w=800", "https://images.unsplash.com/photo-1552083375-1447ce886485?w=800"], "desc": "ÂßãÂª∫‰∫é652Âπ¥ÔºåÁéÑÂ•ò‰∏∫‰øùÂ≠òÁªèÂç∑ËÄåÂª∫„ÄÇ", "detail": "Â°îÈ´ò64.5Á±≥Ôºå2014Âπ¥‰Ωú‰∏∫‰∏ùÁª∏‰πãË∑ØÁªÑÊàêÈÉ®ÂàÜÂàó‰∏∫‰∏ñÁïåÊñáÂåñÈÅó‰∫ß„ÄÇÂåóÂπøÂú∫Êúâ‰∫öÊ¥≤ÊúÄÂ§ßÈü≥‰πêÂñ∑Ê≥â„ÄÇ", "rating": "4.7", "ticket_price": "25", "open_time": "08:00-18:30", "address": "Ë•øÂÆâÂ∏ÇÈõÅÂ°îÂå∫ÊÖàÊÅ©Ë∑Ø1Âè∑", "tips": ["ÁôªÂ°îÂè¶Ë¥≠25ÂÖÉ", "ÂåóÂπøÂú∫Âñ∑Ê≥âÊØèÊôö20:30", "Â§ßÂîê‰∏çÂ§úÂüéÊ≠•Ë°åË°óÂ§úÊôØÂ•Ω", "Â§ßÊÖàÊÅ©ÂØ∫ÂÄºÂæóÂèÇËßÇ"]},
    ],
    "CQ": [
        {"id": "cq_hongyadong", "name": "Ê¥™Â¥ñÊ¥û", "image": "https://images.unsplash.com/photo-1584464491033-06628f3a6b7b?w=600", "gallery": ["https://images.unsplash.com/photo-1584464491033-06628f3a6b7b?w=800", "https://images.unsplash.com/photo-1555217851-6141535bd771?w=800", "https://images.unsplash.com/photo-1590077428593-a55bb07c4665?w=800"], "desc": "Â∑¥Ê∏ù\"ÂêäËÑöÊ•º\"È£éË≤åÔºåÂ§úÊôöÁäπÂ¶ÇÂçÉ‰∏éÂçÉÂØª„ÄÇ", "detail": "Êï¥Â∫ßÂª∫Á≠ë‰æùÂ±±ËÄåÂª∫ÂÖ±11Â±ÇÔºåÈ´òÂ∑ÆËææ75Á±≥ÔºåÂ§úÊôöÁÅØÁÅ´ËæâÁÖåÊòØÈáçÂ∫ÜÊúÄÁÉ≠Èó®ÊâìÂç°Âú∞„ÄÇ", "rating": "4.8", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "ÈáçÂ∫ÜÂ∏ÇÊ∏ù‰∏≠Âå∫ÂòâÈôµÊ±üÊª®Ê±üË∑Ø88Âè∑", "tips": ["Êôö‰∏ä7ÁÇπÂêéÂ§úÊôØÊúÄ‰Ω≥", "ÂçÉÂéÆÈó®Â§ßÊ°•ÊãçÂÖ®ÊôØ", "1Ê•ºÂíå11Ê•ºÈÉΩÂú®È©¨Ë∑ØËæπ", "Ëß£ÊîæÁ¢ëÂíåÈïøÊ±üÁ¥¢ÈÅìÂèØ‰∏ÄÂπ∂Ê∏∏Ëßà"]},
    ],
    "KM": [
        {"id": "km_shilin", "name": "Áü≥ÊûóÈ£éÊôØÂå∫", "image": "https://images.unsplash.com/photo-1470004914212-05527e49370b?w=600", "gallery": ["https://images.unsplash.com/photo-1470004914212-05527e49370b?w=800", "https://images.unsplash.com/photo-1528360983277-13d401cdc186?w=800", "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=800"], "desc": "‰∏ñÁïåËá™ÁÑ∂ÈÅó‰∫ßÔºå\"Â§©‰∏ãÁ¨¨‰∏ÄÂ•áËßÇ\"„ÄÇ", "detail": "ÂñÄÊñØÁâπÂú∞Ë≤åÈóªÂêç‰∫é‰∏ñÔºåÁü≥Â≥∞ÊûóÁ´ãÂçÉÂßøÁôæÊÄÅÔºåÊòØÂ§ßËá™ÁÑ∂2.7‰∫øÂπ¥ÁöÑÊù∞‰Ωú„ÄÇ", "rating": "4.8", "ticket_price": "130", "open_time": "07:30-18:00", "address": "ÊòÜÊòéÂ∏ÇÁü≥ÊûóÂΩùÊóèËá™Ê≤ªÂéø", "tips": ["Âª∫ËÆÆ‰πòÁîµÁì∂ËΩ¶25ÂÖÉ", "Â§ßÂ∞èÁü≥ÊûóËá≥Â∞ë3Â∞èÊó∂", "ÈòøËØóÁéõÁü≥Êó©‰∏äÂéªÈÅø‰∫∫Áæ§", "ÊòÜÊòé‰∏úÈÉ®ÂÆ¢ËøêÁ´ôÂ§ßÂ∑¥2Â∞èÊó∂"]},
        {"id": "km_dianchi", "name": "ÊªáÊ±†", "image": "https://images.unsplash.com/photo-1501526029524-a8ea952b15be?w=600", "gallery": ["https://images.unsplash.com/photo-1501526029524-a8ea952b15be?w=800", "https://images.unsplash.com/photo-1494783367193-149034c05e8f?w=800", "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=800"], "desc": "ÊòÜÊòéÊØç‰∫≤ÊπñÔºå\"È´òÂéüÊòéÁè†\"„ÄÇ", "detail": "‰∫ëÂçóÊúÄÂ§ßÊ∑°Ê∞¥ÊπñÔºåÂÜ¨Â≠£Êï∞‰∏áÂè™Á∫¢Âò¥È∏•È£ûÊù•ËøáÂÜ¨ÔºåÊµ∑ÂüÇÂ§ßÂùùÊòØÊúÄ‰Ω≥ËßÇËµèÁÇπ„ÄÇ", "rating": "4.5", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "ÊòÜÊòéÂ∏ÇË•øÂ±±Âå∫ÊªáÊ±†Ë∑Ø1318Âè∑", "tips": ["ÂÜ¨Â≠£ÂñÇÁ∫¢Âò¥È∏•", "Êµ∑ÂüÇÂ§ßÂùùÂÖçË¥π", "Ë•øÂ±±Á¥¢ÈÅìÁõ¥ËææÈæôÈó®", "ÂÇçÊôöÊó•ËêΩÊúÄÁæé"]},
    ],
    "NJ": [
        {"id": "nj_zhongshanling", "name": "‰∏≠Â±±Èôµ", "image": "https://images.unsplash.com/photo-1576867757603-05b134ebc379?w=600", "gallery": ["https://images.unsplash.com/photo-1576867757603-05b134ebc379?w=800", "https://images.unsplash.com/photo-1546436836-07a91091f160?w=800", "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800"], "desc": "Â≠ô‰∏≠Â±±ÂÖàÁîüÈôµÂØùÔºåÊ∞îÂäøÂÆè‰ºü„ÄÇ", "detail": "ÂÖ±392Á∫ßÁü≥Èò∂Âíå10‰∏™Âπ≥Âè∞Ôºå‰ªé‰∏ãÂæÄ‰∏äÂè™ËßÅÂè∞Èò∂‰∏çËßÅÂπ≥Âè∞ÔºåËÆæËÆ°Á≤æÂ¶ôÁªù‰º¶„ÄÇ", "rating": "4.8", "ticket_price": "0", "open_time": "08:30-17:00ÔºàÂë®‰∏ÄÁ•≠Â†Ç‰∏çÂºÄÊîæÔºâ", "address": "Âçó‰∫¨Â∏ÇÁéÑÊ≠¶Âå∫Áü≥Ë±°Ë∑Ø7Âè∑", "tips": ["ÂÖçË¥π‰ΩÜÈúÄÈ¢ÑÁ∫¶", "392Á∫ßÂè∞Èò∂Á©øËøêÂä®Èûã", "ÁßãÂ≠£Ê¢ßÊ°êÂ§ßÈÅìÁªùÁæé", "ÊòéÂ≠ùÈôµÂèØ‰∏ÄÂπ∂Ê∏∏Ëßà"]},
        {"id": "nj_fuzimiao", "name": "Â§´Â≠êÂ∫ô", "image": "https://images.unsplash.com/photo-1546436836-07a91091f160?w=600", "gallery": ["https://images.unsplash.com/photo-1546436836-07a91091f160?w=800", "https://images.unsplash.com/photo-1576867757603-05b134ebc379?w=800", "https://images.unsplash.com/photo-1599571234909-29ed5d1321d6?w=800"], "desc": "Áß¶Ê∑ÆÈ£éÂÖâÂ∏¶Ê†∏ÂøÉÔºåÂè§ËøπÁæéÈ£üÂ§úÊôØ‰∏Ä‰Ωì„ÄÇ", "detail": "‰∏≠ÂõΩÂõõÂ§ßÊñáÂ∫ô‰πã‰∏ÄÔºåÁß¶Ê∑ÆÊ≤≥ÁîªËà´Â§úÊ∏∏ÊòØÂçó‰∫¨ÊúÄÁªèÂÖ∏ÊóÖÊ∏∏È°πÁõÆ„ÄÇ", "rating": "4.5", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "Âçó‰∫¨Â∏ÇÁß¶Ê∑ÆÂå∫Ë¥°Èô¢Ë°ó", "tips": ["Áß¶Ê∑ÆÊ≤≥Â§úÊ∏∏60ÂÖÉ", "Áßë‰∏æÂçöÁâ©È¶ÜÂÄºÂæóÁúã", "È∏≠Ë°ÄÁ≤â‰∏ùÊ±§ÂøÖÂêÉ", "ÂÖÉÂÆµËäÇÁß¶Ê∑ÆÁÅØ‰ºö"]},
    ],
    "WH": [
        {"id": "wh_huanghelou", "name": "ÈªÑÈπ§Ê•º", "image": "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=600", "gallery": ["https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=800", "https://images.unsplash.com/photo-1583394293214-28ded15ee548?w=800", "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=800"], "desc": "Ê±üÂçó‰∏âÂ§ßÂêçÊ•º‰πã‰∏ÄÔºå\"Â§©‰∏ãÁªùÊôØ\"„ÄÇ", "detail": "ÂßãÂª∫‰∫é223Âπ¥ÔºåÊ•ºÈ´ò5Â±Ç51.4Á±≥ÔºåÂ¥îÈ¢¢\"Êòî‰∫∫Â∑≤‰πòÈªÑÈπ§Âéª\"Ë¢´Ë™â‰∏∫Âîê‰∫∫‰∏ÉÂæã‰πãÈ¶ñ„ÄÇ", "rating": "4.7", "ticket_price": "70", "open_time": "08:30-18:00", "address": "Ê≠¶Ê±âÂ∏ÇÊ≠¶ÊòåÂå∫ËõáÂ±±Ë•øÂ±±Âù°Áâπ1Âè∑", "tips": ["Áôª‰∫îÊ•º‰øØÁû∞ÈïøÊ±ü‰∏âÈïá", "Êó•ËêΩÊó∂ËßÇÈïøÊ±üÊôöÈúû", "Êà∑ÈÉ®Â∑∑Ê≠•Ë°åÂèØËææ", "ÁôΩ‰∫ëÈòÅ‰πüÂÄºÂæóÁúã"]},
        {"id": "wh_donghu", "name": "‰∏úÊπñÈ£éÊôØÂå∫", "image": "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=600", "gallery": ["https://images.unsplash.com/photo-1542038784456-1ea8e935640e?w=800", "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?w=800", "https://images.unsplash.com/photo-1583394293214-28ded15ee548?w=800"], "desc": "‰∏≠ÂõΩÊúÄÂ§ßÂüé‰∏≠ÊπñÔºåË•øÊπñ6ÂÄçÂ§ß„ÄÇ", "detail": "‰∏úÊπñÁªøÈÅìÂÖ®Èïø101.98ÂÖ¨ÈáåÔºåÁ£®Â±±Ê®±Âõ≠ÊúâËøë‰∏áÊ†™Ê®±Ëä±ÔºåÊò•Â≠£Ê®±Ëä±ËäÇÊòØÊ≠¶Ê±âÊúÄÁõõÂ§ßËä±‰∫ã„ÄÇ", "rating": "4.5", "ticket_price": "0", "open_time": "ÂÖ®Â§©ÂºÄÊîæ", "address": "Ê≠¶Ê±âÂ∏ÇÊ≠¶ÊòåÂå∫Ê≤øÊπñÂ§ßÈÅì", "tips": ["ÁªøÈÅìÈ™ëË°åÈùûÂ∏∏ËàíÈÄÇ", "3-4ÊúàÊ®±Ëä±Â≠£ÂøÖÂéª", "Âê¨Ê∂õÊï£Ê≠•Á£®Â±±Áà¨Â±±", "ËêΩÈõÅÊôØÂå∫‰∫∫Â∞ëÂÆâÈùô"]},
    ],
}


# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî ËΩ¶Ê¨°
# =============================================================================

def _generate_trains() -> list[dict[str, Any]]:
    """ÁîüÊàêÊ®°ÊãüËΩ¶Ê¨°Êï∞ÊçÆ"""
    routes: list[tuple[str, str, str, int, float, str]] = [
        ("G1001", "BJ", "SH", 280, 553.0, "È´òÈìÅ"),
        ("G1002", "SH", "BJ", 285, 553.0, "È´òÈìÅ"),
        ("D2001", "BJ", "SH", 360, 327.0, "Âä®ËΩ¶"),
        ("G1301", "BJ", "GZ", 480, 862.0, "È´òÈìÅ"),
        ("G1302", "GZ", "BJ", 485, 862.0, "È´òÈìÅ"),
        ("G8501", "BJ", "CD", 450, 778.0, "È´òÈìÅ"),
        ("G8502", "CD", "BJ", 455, 778.0, "È´òÈìÅ"),
        ("G7501", "BJ", "HZ", 290, 538.0, "È´òÈìÅ"),
        ("G7502", "HZ", "BJ", 295, 538.0, "È´òÈìÅ"),
        ("G6601", "BJ", "XA", 270, 515.5, "È´òÈìÅ"),
        ("G6602", "XA", "BJ", 275, 515.5, "È´òÈìÅ"),
        ("G2001", "SH", "GZ", 420, 793.0, "È´òÈìÅ"),
        ("G2002", "GZ", "SH", 425, 793.0, "È´òÈìÅ"),
        ("G2101", "SH", "HZ", 60, 73.0, "È´òÈìÅ"),
        ("G2102", "HZ", "SH", 65, 73.0, "È´òÈìÅ"),
        ("D3001", "SH", "NJ", 70, 134.5, "Âä®ËΩ¶"),
        ("D3002", "NJ", "SH", 75, 134.5, "Âä®ËΩ¶"),
        ("G3101", "GZ", "KM", 360, 478.0, "È´òÈìÅ"),
        ("G3102", "KM", "GZ", 365, 478.0, "È´òÈìÅ"),
        ("G5001", "CD", "CQ", 80, 154.0, "È´òÈìÅ"),
        ("G5002", "CQ", "CD", 85, 154.0, "È´òÈìÅ"),
        ("G5501", "CD", "KM", 280, 428.0, "È´òÈìÅ"),
        ("G5502", "KM", "CD", 285, 428.0, "È´òÈìÅ"),
        ("G4001", "WH", "GZ", 240, 463.5, "È´òÈìÅ"),
        ("G4002", "GZ", "WH", 245, 463.5, "È´òÈìÅ"),
        ("G4101", "WH", "BJ", 260, 520.5, "È´òÈìÅ"),
        ("G4102", "BJ", "WH", 265, 520.5, "È´òÈìÅ"),
        ("D4201", "NJ", "HZ", 90, 117.0, "Âä®ËΩ¶"),
        ("D4202", "HZ", "NJ", 95, 117.0, "Âä®ËΩ¶"),
        ("G6101", "XA", "CD", 210, 263.0, "È´òÈìÅ"),
        ("G6102", "CD", "XA", 215, 263.0, "È´òÈìÅ"),
    ]

    trains: list[dict[str, Any]] = []
    base_date = datetime(2026, 2, 17)

    for route in routes:
        train_no, from_id, to_id, duration, price, train_type = route
        from_city = next(c["name"] for c in CITIES if c["id"] == from_id)
        to_city = next(c["name"] for c in CITIES if c["id"] == to_id)

        for day_offset in range(7):
            date = base_date + timedelta(days=day_offset)
            for hour_offset, suffix in [(0, ""), (3, "A"), (6, "B")]:
                depart_hour = 7 + hour_offset + (hash(train_no) % 4)
                if depart_hour > 21:
                    continue
                depart_time = date.replace(
                    hour=depart_hour,
                    minute=30 * (hash(train_no + suffix) % 2),
                )
                arrive_time = depart_time + timedelta(minutes=duration)

                seats_remaining = 50 + hash(f"{train_no}{day_offset}{suffix}") % 150
                if seats_remaining < 0:
                    seats_remaining = abs(seats_remaining)

                trains.append({
                    "id": f"{train_no}{suffix}-{date.strftime('%Y%m%d')}",
                    "train_no": f"{train_no}{suffix}" if suffix else train_no,
                    "from_city_id": from_id,
                    "to_city_id": to_id,
                    "from_city": from_city,
                    "to_city": to_city,
                    "train_type": train_type,
                    "depart_time": depart_time.strftime("%Y-%m-%d %H:%M"),
                    "arrive_time": arrive_time.strftime("%Y-%m-%d %H:%M"),
                    "duration": duration,
                    "price": price,
                    "seats_remaining": seats_remaining,
                    "date": date.strftime("%Y-%m-%d"),
                })

    return trains


TRAINS: list[dict[str, Any]] = _generate_trains()
ORDERS: list[dict[str, Any]] = _load_orders()

# =============================================================================
# Ê®°ÊãüÊï∞ÊçÆ ‚Äî Âá∫Ë°åÂÆâÂÖ®ÊèêÈÜí
# =============================================================================

SAFETY_TIPS: list[dict[str, str]] = [
    {"icon": "üé´", "title": "ÂÆûÂêçÂà∂‰πòËΩ¶",
     "content": "ËØ∑Êê∫Â∏¶‰∏éË¥≠Á•®‰ø°ÊÅØ‰∏ÄËá¥ÁöÑÊúâÊïàË∫´‰ªΩËØÅ‰ª∂Âéü‰ª∂Ôºå"
                "ËøõÁ´ôÊó∂ÈúÄÈÖçÂêà‰∫∫ËÑ∏ËØÜÂà´ÂíåË∫´‰ªΩÊ†∏È™å„ÄÇ"},
    {"icon": "üß≥", "title": "Ë°åÊùéÂÆâÊ£ÄÈ°ªÁü•",
     "content": "ÊâÄÊúâË°åÊùéÈ°ªÁªèËøáÂÆâÊ£Ä„ÄÇÁ¶ÅÊ≠¢Êê∫Â∏¶ÊòìÁáÉÊòìÁàÜÂìÅ„ÄÅÁÆ°Âà∂ÂàÄÂÖ∑„ÄÅ"
                "ÂéãÂäõÂÆπÂô®Á≠âÂç±Èô©Áâ©ÂìÅ„ÄÇÈÖíÁ≤æÁ±ªÊ∂≤‰Ωì‰∏çË∂ÖËøá100ml„ÄÇ"},
    {"icon": "‚è∞", "title": "ÊèêÂâçÂà∞Á´ô",
     "content": "Âª∫ËÆÆËá≥Â∞ëÊèêÂâç45ÂàÜÈíüÂà∞ËææËΩ¶Á´ôÔºåÈ¢ÑÁïôÂÖÖË∂≥Êó∂Èó¥ÂÆåÊàêÂèñÁ•®„ÄÅ"
                "ÂÆâÊ£ÄÂíåÊ£ÄÁ•®„ÄÇÈ´òÂ≥∞ÊúüÂª∫ËÆÆÊèêÂâç1Â∞èÊó∂‰ª•‰∏ä„ÄÇ"},
    {"icon": "üö™", "title": "Á´ôÂè∞ÂÆâÂÖ®",
     "content": "Âú®Á´ôÂè∞ÂÄôËΩ¶Êó∂ËØ∑Á´ôÂú®ÈªÑÁ∫ø‰ª•Â§ñÔºåÂàóËΩ¶ËøõÁ´ôÊó∂ÂàáÂãøÈù†ËøëËΩ¶Èó®Ôºå"
                "Á≠âÂàóËΩ¶ÂÅúÁ®≥ÂêéÊúâÂ∫è‰∏ä‰∏ãËΩ¶„ÄÇ"},
    {"icon": "üì±", "title": "ÁîµÂ≠êÂÆ¢Á•®‰ΩøÁî®",
     "content": "Â∑≤ÂÖ®Èù¢Êé®Ë°åÁîµÂ≠êÂÆ¢Á•®ÔºåÂá≠Ë∫´‰ªΩËØÅÂéü‰ª∂Âç≥ÂèØËøõÁ´ô‰πòËΩ¶„ÄÇ"
                "Âª∫ËÆÆÊèêÂâçÂú®12306 APPÊü•ÁúãÊ£ÄÁ•®Âè£ÂíåÂ∫ß‰Ωç‰ø°ÊÅØ„ÄÇ"},
    {"icon": "üè•", "title": "ÂÅ•Â∫∑Âá∫Ë°å",
     "content": "ÊóÖÈÄî‰∏≠Ê≥®ÊÑè‰∏™‰∫∫Âç´ÁîüÔºåËΩ¶Âé¢ÂÜÖ‰Ω©Êà¥Âè£ÁΩ©„ÄÇÂ¶ÇÊúâË∫´‰Ωì‰∏çÈÄÇÔºå"
                "ÂèØËÅîÁ≥ªÂàóËΩ¶Â∑•‰Ωú‰∫∫ÂëòÂØªÊ±ÇÂ∏ÆÂä©„ÄÇÂàóËΩ¶‰∏äÈÖçÂ§áÂü∫Á°ÄÊÄ•ÊïëËçØÂìÅ„ÄÇ"},
    {"icon": "üë∂", "title": "ÂÑøÁ´•‰∏éËÄÅ‰∫∫",
     "content": "Ë∫´È´ò1.2m‰ª•‰∏ãÂÑøÁ´•ÂÖçÁ•®Ôºå1.2m-1.5m‰∫´Âçä‰ª∑‰ºòÊÉ†„ÄÇ"
                "ËÄÅ‰∫∫ÂíåË°åÂä®‰∏ç‰æøÊóÖÂÆ¢ÂèØÊèêÂâçËá¥Áîµ12306Áî≥ËØ∑ÈáçÁÇπÊóÖÂÆ¢ÊúçÂä°„ÄÇ"},
    {"icon": "üîå", "title": "ËΩ¶‰∏äËÆæÊñΩ",
     "content": "È´òÈìÅ/Âä®ËΩ¶ÊØè‰∏™Â∫ß‰Ωç‰∏ãÊñπÈÖçÊúâÁîµÊ∫êÊèíÂ∫ßÔºàÈÉ®ÂàÜÂú®Êâ∂ÊâãÂ§ÑÔºâÔºå"
                "ËΩ¶Âé¢‰∏§Á´ØËÆæÊúâÂºÄÊ∞¥Èó¥„ÄÇÂÖ®ÂàóË¶ÜÁõñÂÖçË¥πWiFi„ÄÇ"},
    {"icon": "üö®", "title": "Á¥ßÊÄ•ÊÉÖÂÜµ",
     "content": "ÈÅáÁ¥ßÊÄ•ÊÉÖÂÜµËØ∑‰øùÊåÅÂÜ∑ÈùôÔºåÊã®ÊâìÂàóËΩ¶Á¥ßÊÄ•ÁîµËØùÊàñÊåâ‰∏ãËΩ¶Âé¢ÂÜÖ"
                "Á¥ßÊÄ•Êä•Ë≠¶ÊåâÈíÆ„ÄÇÁ¥ßÊÄ•ÂÅúËΩ¶ÈòÄ‰ªÖÂú®Âç±Âèä‰∫∫Ë∫´ÂÆâÂÖ®Êó∂‰ΩøÁî®„ÄÇ"},
    {"icon": "üíº", "title": "Ë¥µÈáçÁâ©ÂìÅ",
     "content": "ËØ∑Â¶•ÂñÑ‰øùÁÆ°ÈöèË∫´Ë¥¢Áâ©ÔºåË°åÊùéÊîæÁΩÆÂú®ËßÜÁ∫øËåÉÂõ¥ÂÜÖÁöÑË°åÊùéÊû∂‰∏ä„ÄÇ"
                "Âà∞Á´ôÂâçÊèêÂâçÊï¥ÁêÜË°åÊùéÔºåÈÅøÂÖçÈÅóÊºè„ÄÇ‰∏ãËΩ¶ÂâçÊ£ÄÊü•Â∫ß‰ΩçÂë®Âõ¥„ÄÇ"},
]


# =============================================================================
# Â∑•ÂÖ∑ÂáΩÊï∞
# =============================================================================

def _city_name(city_id: str) -> str:
    for c in CITIES:
        if c["id"] == city_id:
            return c["name"]
    return city_id


def _amap_url(name: str, address: str, city: str = "") -> str:
    """ÁîüÊàêÈ´òÂæ∑Âú∞ÂõæÊêúÁ¥¢ÈìæÊé•ÔºåÁÇπÂáªÂêéÂèØÂú®È´òÂæ∑Âú∞Âõæ‰∏≠ÊâìÂºÄËØ•Âú∞ÁÇπ"""
    keyword = quote(f"{city}{address}{name}", safe="")
    return f"https://uri.amap.com/search?keyword={keyword}&city={quote(city, safe='')}&src=Ë•øÈáéÂá∫Ë°å"


def _inject_amap_url(item: dict[str, Any], city: str = "") -> dict[str, Any]:
    """‰∏∫ÂåÖÂê´ name Âíå address ÁöÑÊï∞ÊçÆÈ°πÊ≥®ÂÖ• amap_url Â≠óÊÆµ"""
    if "address" in item and "name" in item:
        item = {**item, "amap_url": _amap_url(item["name"], item["address"], city)}
    return item


def _smart_recommend(
    from_id: str, to_id: str, date: str, preference: str = "fastest",
) -> list[dict[str, Any]]:
    candidates = [
        t for t in TRAINS
        if t["from_city_id"] == from_id
        and t["to_city_id"] == to_id
        and t["date"] == date
        and t["seats_remaining"] > 0
    ]

    if preference == "fastest":
        candidates.sort(key=lambda t: t["duration"])
    elif preference == "cheapest":
        candidates.sort(key=lambda t: t["price"])
    elif preference == "comfortable":
        candidates.sort(key=lambda t: (-1 if t["train_type"] == "È´òÈìÅ" else 0, t["duration"]))

    for t in candidates:
        reasons: list[str] = []
        if t["duration"] == min(c["duration"] for c in candidates):
            reasons.append("Áî®Êó∂ÊúÄÁü≠")
        if t["price"] == min(c["price"] for c in candidates):
            reasons.append("‰ª∑Ê†ºÊúÄ‰Ωé")
        if t["train_type"] == "È´òÈìÅ":
            reasons.append("È´òÈìÅÁõ¥Ëææ")
        if t["seats_remaining"] > 100:
            reasons.append("‰ΩôÁ•®ÂÖÖË∂≥")
        t["recommend_reasons"] = reasons

    return candidates[:5]


# =============================================================================
# API Ë∑ØÁî±
# =============================================================================

@app.route("/")
def index() -> Any:
    return send_from_directory("static", "index.html")


@app.route("/api/cities", methods=["GET"])
def get_cities() -> Any:
    return jsonify({"code": 0, "data": CITIES})


@app.route("/api/seat_classes", methods=["GET"])
def get_seat_classes() -> Any:
    """Ëé∑ÂèñËà±‰ΩçÁ≠âÁ∫ßÂàóË°®"""
    return jsonify({"code": 0, "data": SEAT_CLASSES})


@app.route("/api/meals", methods=["GET"])
def get_meals() -> Any:
    """Ëé∑ÂèñÈ§êÈ£üÈÄâÈ°π"""
    return jsonify({"code": 0, "data": MEAL_OPTIONS})


@app.route("/api/trains/search", methods=["GET"])
def search_trains() -> Any:
    from_id: str = request.args.get("from", "")
    to_id: str = request.args.get("to", "")
    date: str = request.args.get("date", "")
    if not from_id or not to_id or not date:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ from / to / date"})
    results = [
        t for t in TRAINS
        if t["from_city_id"] == from_id
        and t["to_city_id"] == to_id
        and t["date"] == date
    ]
    results.sort(key=lambda t: t["depart_time"])
    return jsonify({"code": 0, "data": results, "total": len(results)})


@app.route("/api/trains/recommend", methods=["GET"])
def recommend_trains() -> Any:
    from_id: str = request.args.get("from", "")
    to_id: str = request.args.get("to", "")
    date: str = request.args.get("date", "")
    preference: str = request.args.get("preference", "fastest")
    if not from_id or not to_id or not date:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞"})
    results = _smart_recommend(from_id, to_id, date, preference)
    return jsonify({"code": 0, "data": results, "total": len(results)})


@app.route("/api/attractions", methods=["GET"])
def get_attractions() -> Any:
    city_id: str = request.args.get("city_id", "")
    if not city_id:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ë city_id ÂèÇÊï∞"})
    city = _city_name(city_id)
    raw = ATTRACTIONS.get(city_id, [])
    data = [
        _inject_amap_url(
            {k: v for k, v in a.items() if k not in ("detail", "gallery", "tips")},
            city,
        )
        for a in raw
    ]
    return jsonify({"code": 0, "data": data, "city": city})


@app.route("/api/attractions/<attraction_id>", methods=["GET"])
def get_attraction_detail(attraction_id: str) -> Any:
    for city_attractions in ATTRACTIONS.values():
        for a in city_attractions:
            if a.get("id") == attraction_id:
                city_id_found = next(
                    (cid for cid, alist in ATTRACTIONS.items() if a in alist), "",
                )
                city = _city_name(city_id_found)
                return jsonify({
                    "code": 0,
                    "data": _inject_amap_url(dict(a), city),
                    "city": city,
                })
    return jsonify({"code": 404, "msg": "ÊôØÁÇπ‰∏çÂ≠òÂú®"})


@app.route("/api/foods", methods=["GET"])
def get_foods() -> Any:
    """Êé®ËçêÁõÆÁöÑÂú∞ÁæéÈ£ü"""
    city_id: str = request.args.get("city_id", "")
    if not city_id:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ë city_id ÂèÇÊï∞"})
    city = _city_name(city_id)
    data = [_inject_amap_url(dict(f), city) for f in FOODS.get(city_id, [])]
    return jsonify({"code": 0, "data": data, "city": city})


@app.route("/api/hotels", methods=["GET"])
def get_hotels() -> Any:
    """Êé®ËçêÁõÆÁöÑÂú∞ÈÖíÂ∫ó"""
    city_id: str = request.args.get("city_id", "")
    if not city_id:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ë city_id ÂèÇÊï∞"})
    city = _city_name(city_id)
    data = [_inject_amap_url(dict(h), city) for h in HOTELS.get(city_id, [])]
    return jsonify({"code": 0, "data": data, "city": city})


@app.route("/api/orders", methods=["POST"])
def create_order() -> Any:
    """Ë¥≠Á•®‰∏ãÂçïÔºàÂê´Ëà±‰Ωç„ÄÅÈ§êÈ£üÈÄâÊã©ÂíåÁßØÂàÜËé∑ÂèñÔºâ"""
    body: dict[str, Any] = request.get_json(force=True)
    train_id: str = body.get("train_id", "")
    passenger_name: str = body.get("passenger_name", "")
    phone: str = body.get("phone", "")
    quantity: int = int(body.get("quantity", 1))
    seat_class_id: str = body.get("seat_class", "second")
    meal_id: str = body.get("meal", "none")

    if not train_id or not passenger_name or not phone:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞"})

    train = next((t for t in TRAINS if t["id"] == train_id), None)
    if not train:
        return jsonify({"code": 404, "msg": "ËΩ¶Ê¨°‰∏çÂ≠òÂú®"})

    if train["seats_remaining"] < quantity:
        return jsonify({"code": 409, "msg": "‰ΩôÁ•®‰∏çË∂≥"})

    seat_class = next((s for s in SEAT_CLASSES if s["id"] == seat_class_id), SEAT_CLASSES[2])
    meal = next((m for m in MEAL_OPTIONS if m["id"] == meal_id), MEAL_OPTIONS[0])

    ticket_price = round(train["price"] * seat_class["multiplier"], 1)
    meal_total = meal["price"] * quantity
    total_price = round(ticket_price * quantity + meal_total, 1)

    train["seats_remaining"] -= quantity

    # ÁßØÂàÜËÆ°ÁÆó: ÊØèÊ∂àË¥π1ÂÖÉËé∑1ÁßØÂàÜ
    points_earned = int(total_price) * POINTS_PER_YUAN

    order: dict[str, Any] = {
        "order_id": uuid.uuid4().hex[:12].upper(),
        "train": {
            "id": train["id"],
            "train_no": train["train_no"],
            "from_city": train["from_city"],
            "to_city": train["to_city"],
            "train_type": train["train_type"],
            "depart_time": train["depart_time"],
            "arrive_time": train["arrive_time"],
            "duration": train["duration"],
            "date": train["date"],
        },
        "passenger_name": passenger_name,
        "phone": phone,
        "quantity": quantity,
        "seat_class": {"id": seat_class["id"], "name": seat_class["name"], "icon": seat_class["icon"]},
        "meal": {"id": meal["id"], "name": meal["name"], "icon": meal["icon"], "price": meal["price"]},
        "ticket_price": ticket_price,
        "meal_total": meal_total,
        "total_price": total_price,
        "points_earned": points_earned,
        "status": "Â∑≤Âá∫Á•®",
        "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
    }
    ORDERS.append(order)
    _save_orders(ORDERS)

    # ÂèëÊîæÁßØÂàÜ
    user_points = _add_points(
        phone, points_earned,
        f"Ë¥≠Á•® {train['train_no']} {train['from_city']}‚Üí{train['to_city']}",
    )

    return jsonify({
        "code": 0, "data": order, "msg": "Ë¥≠Á•®ÊàêÂäü",
        "points_earned": points_earned,
        "points_total": user_points["points"],
        "level": user_points["level"],
    })


@app.route("/api/orders", methods=["GET"])
def get_orders() -> Any:
    phone: str = request.args.get("phone", "")
    if phone:
        data = [o for o in ORDERS if o["phone"] == phone]
    else:
        data = ORDERS
    return jsonify({"code": 0, "data": data, "total": len(data)})


@app.route("/api/points", methods=["GET"])
def get_points() -> Any:
    """Êü•ËØ¢Áî®Êà∑ÁßØÂàÜ‰ø°ÊÅØ"""
    phone: str = request.args.get("phone", "")
    if not phone:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ë phone ÂèÇÊï∞"})
    all_points = _load_points()
    user = all_points.get(phone)
    if not user:
        level_name, level_icon, discount = _calc_level(0)
        return jsonify({
            "code": 0,
            "data": {
                "points": 0, "total_earned": 0,
                "level": level_name, "level_icon": level_icon,
                "discount": discount, "history": [],
            },
        })
    level_name, level_icon, discount = _calc_level(user.get("total_earned", 0))
    user["level"] = level_name
    user["level_icon"] = level_icon
    user["discount"] = discount
    return jsonify({"code": 0, "data": user})


@app.route("/api/points/levels", methods=["GET"])
def get_points_levels() -> Any:
    """Ëé∑ÂèñÁßØÂàÜÁ≠âÁ∫ßËßÑÂàô"""
    data = [
        {
            "threshold": t[0],
            "level": t[1],
            "icon": t[2],
            "discount": t[3],
            "discount_label": f"{int(t[3]*100)}%ÊäòÊâ£" if t[3] > 0 else "Êó†ÊäòÊâ£",
        }
        for t in LEVEL_THRESHOLDS
    ]
    return jsonify({"code": 0, "data": data})


@app.route("/api/trains/discount", methods=["GET"])
def get_discount_trains() -> Any:
    """ÊäòÊâ£ËΩ¶Á•®Êé®Ëçê ‚Äî Âü∫‰∫é‰ΩôÁ•®Â§ö„ÄÅÂá∫ÂèëÊó∂Èó¥ÂÜ∑Èó®Á≠âÊù°‰ª∂ÁîüÊàêÊäòÊâ£"""
    from_id: str = request.args.get("from", "")
    to_id: str = request.args.get("to", "")
    date: str = request.args.get("date", "")
    if not from_id or not to_id or not date:
        return jsonify({"code": 400, "msg": "Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞ from / to / date"})

    candidates = [
        t for t in TRAINS
        if t["from_city_id"] == from_id
        and t["to_city_id"] == to_id
        and t["date"] == date
        and t["seats_remaining"] > 0
    ]

    discounted: list[dict[str, Any]] = []
    for t in candidates:
        discount_rate = 0.0
        reasons: list[str] = []

        # ‰ΩôÁ•®ÂÖÖË∂≥ > 120 ‚Üí ÊäòÊâ£
        if t["seats_remaining"] > 120:
            discount_rate += 0.10
            reasons.append("‰ΩôÁ•®ÂÖÖË∂≥ÁâπÊÉ†")

        # Êó©Áè≠(7-9ÁÇπ‰πãÂâç)ÊàñÊôöÁè≠(18ÁÇπÂêé)ÂÜ∑Èó®Êó∂ÊÆµ
        hour = int(t["depart_time"].split(" ")[1].split(":")[0])
        if hour <= 8 or hour >= 19:
            discount_rate += 0.08
            reasons.append("ÂÜ∑Èó®Êó∂ÊÆµ‰ºòÊÉ†")
        elif hour >= 12 and hour <= 14:
            discount_rate += 0.05
            reasons.append("ÂçàÈó¥ÁâπÊÉ†")

        # Âä®ËΩ¶ÊØîÈ´òÈìÅÂ§ö‰∏ÄÁÇπÊäòÊâ£
        if t["train_type"] == "Âä®ËΩ¶":
            discount_rate += 0.05
            reasons.append("Âä®ËΩ¶‰∏ì‰∫´ÊäòÊâ£")

        if discount_rate > 0:
            discount_rate = min(discount_rate, 0.20)  # ÊúÄÈ´ò20%ÊäòÊâ£
            original_price = t["price"]
            discounted_price = round(original_price * (1 - discount_rate), 1)
            discounted.append({
                **t,
                "original_price": original_price,
                "discounted_price": discounted_price,
                "discount_rate": round(discount_rate, 2),
                "discount_label": f"{int(discount_rate * 100)}%off",
                "discount_reasons": reasons,
            })

    discounted.sort(key=lambda x: x["discount_rate"], reverse=True)
    return jsonify({"code": 0, "data": discounted[:10], "total": len(discounted[:10])})


@app.route("/api/safety_tips", methods=["GET"])
def get_safety_tips() -> Any:
    """Ëé∑ÂèñÂá∫Ë°åÂÆâÂÖ®ÊèêÈÜí"""
    return jsonify({"code": 0, "data": SAFETY_TIPS})


# =============================================================================
# ÊîØ‰ªòÁõ∏ÂÖ≥Êé•Âè£
# =============================================================================

# ÂØºÂÖ•ÊîØ‰ªòÊ®°ÂùóÔºàÊîæÂú®Êñá‰ª∂È°∂ÈÉ®ÂØºÂÖ•Êõ¥‰Ω≥Ôºâ
# from payment import create_payment_order, create_mock_payment, verify_payment_result

@app.route("/api/payment/create", methods=["POST"])
def create_payment() -> Any:
    """
    ÂàõÂª∫ÂæÆ‰ø°ÊîØ‰ªòËÆ¢Âçï
    ËØ∑Ê±Ç‰Ωì: { train_id, passenger_name, phone, quantity, seat_class, meal, openid }
    """
    body: dict[str, Any] = request.get_json(force=True)
    
    # ÂèÇÊï∞Ê†°È™å
    required = ["train_id", "passenger_name", "phone", "quantity", "openid"]
    for field in required:
        if not body.get(field):
            return jsonify({"code": 400, "msg": f"Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞: {field}"})
    
    train_id = body["train_id"]
    passenger_name = body["passenger_name"]
    phone = body["phone"]
    quantity = int(body.get("quantity", 1))
    seat_class_id = body.get("seat_class", "second")
    meal_id = body.get("meal", "none")
    openid = body["openid"]  # Áî®Êà∑ÂæÆ‰ø°openid
    
    # Êü•ÊâæËΩ¶Ê¨°
    train = next((t for t in TRAINS if t["id"] == train_id), None)
    if not train:
        return jsonify({"code": 404, "msg": "ËΩ¶Ê¨°‰∏çÂ≠òÂú®"})
    
    if train["seats_remaining"] < quantity:
        return jsonify({"code": 409, "msg": "‰ΩôÁ•®‰∏çË∂≥"})
    
    # ËÆ°ÁÆó‰ª∑Ê†º
    seat_class = next((s for s in SEAT_CLASSES if s["id"] == seat_class_id), SEAT_CLASSES[2])
    meal = next((m for m in MEAL_OPTIONS if m["id"] == meal_id), MEAL_OPTIONS[0])
    
    ticket_price = round(train["price"] * seat_class["multiplier"], 1)
    meal_total = meal["price"] * quantity
    total_price = round(ticket_price * quantity + meal_total, 1)
    
    # ÈáëÈ¢ùËΩ¨Êç¢‰∏∫ÂàÜÔºàÂæÆ‰ø°ÊîØ‰ªò‰ª•ÂàÜ‰∏∫Âçï‰ΩçÔºâ
    total_fee = int(total_price * 100)
    
    # ÊûÑÂª∫ËÆ¢ÂçïÊï∞ÊçÆ
    order_data = {
        "train_id": train_id,
        "train_no": train["train_no"],
        "from_city": train["from_city"],
        "to_city": train["to_city"],
        "passenger_name": passenger_name,
        "phone": phone,
        "quantity": quantity,
        "seat_class": seat_class,
        "meal": meal,
        "ticket_price": ticket_price,
        "meal_total": meal_total,
        "total_price": total_price,
        "openid": openid,
    }
    
    # Ë∞ÉÁî®ÊîØ‰ªòÊ®°ÂùóÂàõÂª∫ÊîØ‰ªòËÆ¢Âçï
    # ÂÆûÈôÖÈ°πÁõÆ‰∏≠‰ΩøÁî® create_payment_order
    # ÊºîÁ§∫Ê®°Âºè‰ΩøÁî® create_mock_payment
    try:
        from payment import create_mock_payment
        result = create_mock_payment(order_data)
        
        if result["code"] == 0:
            # ‰øùÂ≠òÂæÖÊîØ‰ªòËÆ¢ÂçïÂà∞ÂÜÖÂ≠òÔºàÂÆûÈôÖÂ∫î‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºâ
            pending_order = {
                **order_data,
                "out_trade_no": result["data"]["out_trade_no"],
                "status": "ÂæÖÊîØ‰ªò",
                "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
            }
            # ÂÆûÈôÖÈ°πÁõÆ‰∏≠Â∫î‰øùÂ≠òÂà∞Êï∞ÊçÆÂ∫ìÔºåËøôÈáåÁÆÄÂåñÂ§ÑÁêÜ
            
        return jsonify(result)
        
    except Exception as e:
        return jsonify({"code": 500, "msg": f"ÊîØ‰ªòËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•: {str(e)}"})


@app.route("/api/payment/confirm", methods=["POST"])
def confirm_payment() -> Any:
    """
    Á°ÆËÆ§ÊîØ‰ªòÊàêÂäüÔºåÂàõÂª∫Ê≠£ÂºèËÆ¢Âçï
    ËØ∑Ê±Ç‰Ωì: { out_trade_no, train_id, passenger_name, phone, ... }
    """
    body: dict[str, Any] = request.get_json(force=True)
    
    # ÂèÇÊï∞Ê†°È™å
    required = ["train_id", "passenger_name", "phone", "quantity", "seat_class", "meal", "total_price"]
    for field in required:
        if not body.get(field):
            return jsonify({"code": 400, "msg": f"Áº∫Â∞ëÂøÖË¶ÅÂèÇÊï∞: {field}"})
    
    train_id = body["train_id"]
    passenger_name = body["passenger_name"]
    phone = body["phone"]
    quantity = int(body.get("quantity", 1))
    seat_class = body.get("seat_class", {})
    meal = body.get("meal", {})
    total_price = body.get("total_price", 0)
    
    # Êü•ÊâæËΩ¶Ê¨°
    train = next((t for t in TRAINS if t["id"] == train_id), None)
    if not train:
        return jsonify({"code": 404, "msg": "ËΩ¶Ê¨°‰∏çÂ≠òÂú®"})
    
    # Êâ£Âáè‰ΩôÁ•®
    if train["seats_remaining"] < quantity:
        return jsonify({"code": 409, "msg": "‰ΩôÁ•®‰∏çË∂≥"})
    train["seats_remaining"] -= quantity
    
    # ËÆ°ÁÆóÁßØÂàÜ
    points_earned = int(total_price) * POINTS_PER_YUAN
    
    # ÂàõÂª∫ËÆ¢Âçï
    order: dict[str, Any] = {
        "order_id": uuid.uuid4().hex[:12].upper(),
        "out_trade_no": body.get("out_trade_no", ""),
        "train": {
            "id": train["id"],
            "train_no": train["train_no"],
            "from_city": train["from_city"],
            "to_city": train["to_city"],
            "train_type": train["train_type"],
            "depart_time": train["depart_time"],
            "arrive_time": train["arrive_time"],
            "duration": train["duration"],
            "date": train["date"],
        },
        "passenger_name": passenger_name,
        "phone": phone,
        "quantity": quantity,
        "seat_class": seat_class,
        "meal": meal,
        "total_price": total_price,
        "points_earned": points_earned,
        "status": "Â∑≤ÊîØ‰ªò",
        "pay_time": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "created_at": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
    }
    
    ORDERS.append(order)
    _save_orders(ORDERS)
    
    # ÂèëÊîæÁßØÂàÜ
    user_points = _add_points(
        phone, points_earned,
        f"Ë¥≠Á•® {train['train_no']} {train['from_city']}‚Üí{train['to_city']}",
    )
    
    return jsonify({
        "code": 0,
        "data": order,
        "msg": "ÊîØ‰ªòÊàêÂäü",
        "points_earned": points_earned,
        "points_total": user_points["points"],
        "level": user_points["level"],
    })


@app.route("/api/payment/notify", methods=["POST"])
def payment_notify() -> Any:
    """ÂæÆ‰ø°ÊîØ‰ªòÁªìÊûúÈÄöÁü•ÂõûË∞É"""
    # ÂÆûÈôÖÈ°πÁõÆ‰∏≠ÈúÄË¶ÅÈ™åËØÅÂæÆ‰ø°ÊîØ‰ªòÁ≠æÂêç
    # Êõ¥Êñ∞ËÆ¢ÂçïÊîØ‰ªòÁä∂ÊÄÅ
    return jsonify({"code": 0, "msg": "success"})


if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5050)
